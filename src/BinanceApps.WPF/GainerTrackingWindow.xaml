<Window x:Class="BinanceApps.WPF.GainerTrackingWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="è¿‘æœŸæ¶¨å¹…æ¦œè¿½è¸ª" Height="900" Width="1600"
        WindowStartupLocation="CenterScreen"
        Loaded="Window_Loaded"
        Closing="Window_Closing">
    
    <Window.Resources>
        <Style x:Key="ButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Background" Value="#0078D4"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
        </Style>
        
        <Style x:Key="StopButtonStyle" TargetType="Button" BasedOn="{StaticResource ButtonStyle}">
            <Setter Property="Background" Value="#D13438"/>
        </Style>
    </Window.Resources>
    
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>  <!-- å‚æ•°å’ŒæŽ§åˆ¶åŒº -->
            <RowDefinition Height="*"/>     <!-- æ•°æ®åŒºåŸŸ -->
        </Grid.RowDefinitions>
        
        <!-- å‚æ•°å’ŒæŽ§åˆ¶åŒºåŸŸ -->
        <Border Grid.Row="0" Background="#F5F5F5" BorderBrush="#E0E0E0" 
                BorderThickness="1" CornerRadius="4" Padding="15" Margin="0,0,0,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- ç¬¬ä¸€è¡Œï¼šå‚æ•°è®¾ç½® -->
                <WrapPanel Grid.Row="0" Margin="0,0,0,10">
                    <TextBlock Text="Nå¤©æ¶¨å¹…:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox x:Name="txtNDays" Width="60" Height="28" Text="30" VerticalContentAlignment="Center"/>
                    <TextBlock Text="å¤©" VerticalAlignment="Center" Margin="2,0,15,0"/>
                    
                    <TextBlock Text="æŽ’è¡Œæ•°:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox x:Name="txtTopCount" Width="60" Height="28" Text="30" VerticalContentAlignment="Center"/>
                    <TextBlock Text="å" VerticalAlignment="Center" Margin="2,0,15,0"/>
                    
                    <TextBlock Text="å›žæ’¤ä¸€åŒº:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox x:Name="txtPullbackZone1" Width="60" Height="28" Text="10" VerticalContentAlignment="Center"/>
                    <TextBlock Text="%" VerticalAlignment="Center" Margin="2,0,15,0"/>
                    
                    <TextBlock Text="å›žæ’¤äºŒåŒº:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox x:Name="txtPullbackZone2" Width="60" Height="28" Text="20" VerticalContentAlignment="Center"/>
                    <TextBlock Text="%" VerticalAlignment="Center" Margin="2,0,15,0"/>
                    
                    <TextBlock Text="æ‰«æé—´éš”:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox x:Name="txtScanInterval" Width="60" Height="28" Text="5" VerticalContentAlignment="Center"/>
                    <TextBlock Text="ç§’" VerticalAlignment="Center" Margin="2,0,15,0"/>
                    
                    <TextBlock Text="ç¼“å­˜æ—¶é—´:" VerticalAlignment="Center" Margin="0,0,5,0"/>
                    <TextBox x:Name="txtCacheExpiry" Width="60" Height="28" Text="240" VerticalContentAlignment="Center"/>
                    <TextBlock Text="å°æ—¶" VerticalAlignment="Center" Margin="2,0,0,0"/>
                </WrapPanel>
                
                <!-- ç¬¬äºŒè¡Œï¼šæŽ§åˆ¶æŒ‰é’®å’ŒçŠ¶æ€ -->
                <StackPanel Grid.Row="1" Orientation="Horizontal">
                    <Button x:Name="btnToggleMonitoring" Content="å¯åŠ¨ç›‘æŽ§" Width="120" Height="32" 
                            Style="{StaticResource ButtonStyle}" Click="BtnToggleMonitoring_Click"/>
                    
                    <TextBlock x:Name="txtStatus" VerticalAlignment="Center" 
                               Margin="20,0,0,0" Foreground="#666" Text="å°±ç»ª"/>
                    
                    <TextBlock x:Name="txtNextScan" VerticalAlignment="Center" 
                               Margin="20,0,0,0" Foreground="#0078D4"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- æ•°æ®åŒºåŸŸ -->
        <Grid Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="3*"/>
            </Grid.ColumnDefinitions>
            
            <!-- å·¦ä¸Šï¼šå®žæ—¶Nå¤©æ¶¨å¹…æ¦œ -->
            <Border Grid.Row="0" Grid.Column="0" BorderBrush="#E0E0E0" BorderThickness="1" 
                    Background="White" CornerRadius="4" Margin="0,0,5,5">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <Border Grid.Row="0" Background="#4CAF50" Padding="10" 
                            MouseLeftButtonDown="HeaderBorder_MouseLeftButtonDown" 
                            Tag="dgRealtime" Cursor="Hand">
                        <TextBlock HorizontalAlignment="Center" Foreground="White">
                            <Run Text="ðŸ“ˆ å®žæ—¶æ¶¨å¹…æ¦œ" FontSize="14" FontWeight="Bold"/>
                            <Run x:Name="txtRealtimeCount" Text="(0ä¸ª)" FontSize="12"/>
                        </TextBlock>
                    </Border>
                    
                    <DataGrid x:Name="dgRealtime" Grid.Row="1" 
                              AutoGenerateColumns="False" IsReadOnly="True"
                              RowHeaderWidth="0" GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column" AlternatingRowBackground="#E8F5E9"
                              CanUserSortColumns="True" FontSize="13"
                              MouseDoubleClick="DataGrid_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="æŽ’å" Binding="{Binding Rank}" Width="40"/>
                            <DataGridTextColumn Header="åˆçº¦" Binding="{Binding Symbol}" Width="70"/>
                            <DataGridTextColumn Header="æœ€æ–°ä»·" Binding="{Binding LastPrice, StringFormat=\{0:F4\}}" Width="70"/>
                            <DataGridTextColumn Header="Nå¤©æ¶¨å¹…" Binding="{Binding NDayGainPercent, StringFormat=\{0:F2\}%}" Width="75"/>
                            <DataGridTextColumn Header="24Hæ¶¨å¹…" Binding="{Binding PriceChangePercent24h, StringFormat=\{0:F2\}%}" Width="70"/>
                            <DataGridTextColumn Header="24Hæˆäº¤é¢" Binding="{Binding QuoteVolume24h, StringFormat=\{0:N0\}}" Width="90"/>
                            <DataGridTextColumn Header="é‡æ¯”" Binding="{Binding VolumeRatio, StringFormat=\{0:F1\}%}" Width="60"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>
            
            <!-- å·¦ä¸‹ï¼šç¼“å­˜å›žæ”¶åŒº -->
            <Border Grid.Row="1" Grid.Column="0" BorderBrush="#E0E0E0" BorderThickness="1" 
                    Background="White" CornerRadius="4" Margin="0,5,5,0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>
                    
                    <Border Grid.Row="0" Background="#9E9E9E" Padding="8"
                            MouseLeftButtonDown="HeaderBorder_MouseLeftButtonDown"
                            Tag="dgRecycled" Cursor="Hand">
                        <TextBlock HorizontalAlignment="Center" Foreground="White">
                            <Run Text="â™»ï¸ ç¼“å­˜å›žæ”¶åŒº" FontSize="13" FontWeight="Bold"/>
                            <Run x:Name="txtRecycledCount" Text="(0ä¸ª)" FontSize="11"/>
                        </TextBlock>
                    </Border>
                    
                    <DataGrid x:Name="dgRecycled" Grid.Row="1" 
                              AutoGenerateColumns="False" IsReadOnly="True"
                              RowHeaderWidth="0" GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column" AlternatingRowBackground="#F5F5F5"
                              CanUserSortColumns="True" FontSize="13"
                              MouseDoubleClick="DataGrid_MouseDoubleClick">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="åˆçº¦" Binding="{Binding Symbol}" Width="80"/>
                            <DataGridTextColumn Header="å›žæ”¶æ—¶é—´" Binding="{Binding RecycleTime, StringFormat=\{0:MM-dd HH:mm\}}" Width="100"/>
                            <DataGridTextColumn Header="ç¼“å­˜æ—¶é•¿(h)" Binding="{Binding CachedDurationHours, StringFormat=\{0:F0\}}" Width="80"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </Border>
            
            <!-- å³ä¾§ï¼š2x2ç½‘æ ¼ -->
            <Grid Grid.Row="0" Grid.RowSpan="2" Grid.Column="1" Margin="5,0,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- å·¦ä¸Šï¼šæ¶¨å¹…æ¦œç¼“å­˜åŒº -->
                <Border Grid.Row="0" Grid.Column="0" BorderBrush="#E0E0E0" 
                        BorderThickness="1" Background="White" CornerRadius="4" 
                        Margin="0,0,5,5">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <Border Grid.Row="0" Background="#2196F3" Padding="8"
                                MouseLeftButtonDown="HeaderBorder_MouseLeftButtonDown"
                                Tag="dgCached" Cursor="Hand">
                            <TextBlock HorizontalAlignment="Center" Foreground="White">
                                <Run Text="ðŸ“¦ æ¶¨å¹…æ¦œç¼“å­˜åŒº" FontSize="13" FontWeight="Bold"/>
                                <Run x:Name="txtCachedCount" Text="(0ä¸ª)" FontSize="11"/>
                            </TextBlock>
                        </Border>
                        
                        <DataGrid x:Name="dgCached" Grid.Row="1" 
                                  AutoGenerateColumns="False" IsReadOnly="True"
                                  RowHeaderWidth="0" GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column" AlternatingRowBackground="#E3F2FD"
                                  CanUserSortColumns="True" FontSize="12"
                                  MouseDoubleClick="DataGrid_MouseDoubleClick">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="åˆçº¦" Binding="{Binding Symbol}" Width="65"/>
                                <DataGridTextColumn Header="æœ€æ–°ä»·" Binding="{Binding LastPrice, StringFormat=\{0:F4\}}" Width="60"/>
                                <DataGridTextColumn Header="å½•å…¥ä»·" Binding="{Binding EntryPrice, StringFormat=\{0:F4\}}" Width="60"/>
                                <DataGridTextColumn Header="å½•å…¥æŽ’å" Binding="{Binding EntryRank}" Width="55"/>
                                <DataGridTextColumn Header="å½•å…¥åŽæœ€é«˜" Binding="{Binding HighestPriceAfterEntry, StringFormat=\{0:F4\}}" Width="70"/>
                                
                                <!-- å½•å…¥åŽæ¶¨å¹… - ç»¿è‰²æ˜¾ç¤º -->
                                <DataGridTemplateColumn Header="å½•å…¥åŽæ¶¨å¹…" Width="70">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding PriceGainFromEntry, StringFormat=\{0:F1\}%}" 
                                                       Foreground="Green"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                
                                <!-- å½“å‰å›žæ’¤ - çº¢è‰²æ˜¾ç¤º -->
                                <DataGridTemplateColumn Header="å½“å‰å›žæ’¤" Width="65">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding CurrentPullbackPercent, StringFormat=\{0:F1\}%}" 
                                                       Foreground="Red"/>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                
                                <DataGridTextColumn Header="å½•å…¥æ—¶é—´" Binding="{Binding EntryTime, StringFormat=\{0:MM-dd HH:mm\}}" Width="80"/>
                                <DataGridTextColumn Header="å‰©ä½™(h)" Binding="{Binding RemainingCacheHours, StringFormat=\{0:F1\}}" Width="55"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>
                
                <!-- å³ä¸Šï¼šå›žæ’¤ä¸€åŒº -->
                <Border Grid.Row="0" Grid.Column="1" BorderBrush="#E0E0E0" 
                        BorderThickness="1" Background="White" CornerRadius="4" 
                        Margin="5,0,0,5">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <Border Grid.Row="0" Background="#FF9800" Padding="8"
                                MouseLeftButtonDown="HeaderBorder_MouseLeftButtonDown"
                                Tag="dgPullback1" Cursor="Hand">
                            <TextBlock HorizontalAlignment="Center" Foreground="White">
                                <Run Text="ðŸ“‰ å›žæ’¤ä¸€åŒº" FontSize="13" FontWeight="Bold"/>
                                <Run x:Name="txtPullback1Count" Text="(0ä¸ª)" FontSize="11"/>
                            </TextBlock>
                        </Border>
                        
                        <DataGrid x:Name="dgPullback1" Grid.Row="1" 
                                  AutoGenerateColumns="False" IsReadOnly="True"
                                  RowHeaderWidth="0" GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column" AlternatingRowBackground="#FFF3E0"
                                  CanUserSortColumns="True" FontSize="13"
                                  MouseDoubleClick="DataGrid_MouseDoubleClick">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="åˆçº¦" Binding="{Binding Symbol}" Width="80"/>
                                <DataGridTextColumn Header="æœ€æ–°ä»·" Binding="{Binding LastPrice, StringFormat=\{0:F4\}}" Width="70"/>
                                <DataGridTextColumn Header="æœ€é«˜ä»·" Binding="{Binding HighestPriceAfterEntry, StringFormat=\{0:F4\}}" Width="70"/>
                                <DataGridTextColumn Header="å›žæ’¤" Binding="{Binding CurrentPullbackPercent, StringFormat=\{0:F1\}%}" Width="60"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>
                
                <!-- å·¦ä¸‹ï¼šå›žæ’¤äºŒåŒº -->
                <Border Grid.Row="1" Grid.Column="0" BorderBrush="#E0E0E0" 
                        BorderThickness="1" Background="White" CornerRadius="4" 
                        Margin="0,5,5,0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <Border Grid.Row="0" Background="#F44336" Padding="8"
                                MouseLeftButtonDown="HeaderBorder_MouseLeftButtonDown"
                                Tag="dgPullback2" Cursor="Hand">
                            <TextBlock HorizontalAlignment="Center" Foreground="White">
                                <Run Text="ðŸ“Š å›žæ’¤äºŒåŒº" FontSize="13" FontWeight="Bold"/>
                                <Run x:Name="txtPullback2Count" Text="(0ä¸ª)" FontSize="11"/>
                            </TextBlock>
                        </Border>
                        
                        <DataGrid x:Name="dgPullback2" Grid.Row="1" 
                                  AutoGenerateColumns="False" IsReadOnly="True"
                                  RowHeaderWidth="0" GridLinesVisibility="Horizontal"
                                  HeadersVisibility="Column" AlternatingRowBackground="#FFEBEE"
                                  CanUserSortColumns="True" FontSize="13"
                                  MouseDoubleClick="DataGrid_MouseDoubleClick">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="åˆçº¦" Binding="{Binding Symbol}" Width="80"/>
                                <DataGridTextColumn Header="æœ€æ–°ä»·" Binding="{Binding LastPrice, StringFormat=\{0:F4\}}" Width="70"/>
                                <DataGridTextColumn Header="æœ€é«˜ä»·" Binding="{Binding HighestPriceAfterEntry, StringFormat=\{0:F4\}}" Width="70"/>
                                <DataGridTextColumn Header="å›žæ’¤" Binding="{Binding CurrentPullbackPercent, StringFormat=\{0:F1\}%}" Width="60"/>
                            </DataGrid.Columns>
                        </DataGrid>
                    </Grid>
                </Border>
                
                <!-- å³ä¸‹ï¼šç©ºç™½é¢„ç•™åŒºåŸŸ -->
                <Border Grid.Row="1" Grid.Column="1" BorderBrush="#E0E0E0" 
                        BorderThickness="1" Background="White" CornerRadius="4" 
                        Margin="5,5,0,0">
                    <TextBlock Text="é¢„ç•™åŒºåŸŸ" HorizontalAlignment="Center" VerticalAlignment="Center" 
                               Foreground="#999" FontSize="14"/>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>

