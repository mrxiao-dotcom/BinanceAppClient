# 组合表格对齐修复

## 📋 问题描述

组合列表中，表头和内容列对应不上，导致表格显示不整齐。

## 🔍 问题原因

### 1. 名称列对齐不一致
- **表头**：`TextAlignment.Center`（居中对齐）
- **内容**：`TextAlignment.Left`（左对齐）
- **结果**：名称列的表头和内容错位

### 2. Margin设置不统一
- **表头**：所有可排序列都有 `Margin(0, 0, 5, 0)`
- **内容**：只有名称列有 `Margin(5, 0, 5, 0)`，其他列无Margin
- **结果**：除名称外的其他列也出现轻微错位

## ✅ 解决方案

修改 `CreateSortablePortfolioHeader()` 方法，使表头的对齐方式和边距与内容行保持一致。

### 修改内容

```csharp
private TextBlock CreateSortablePortfolioHeader(string column, string title)
{
    var isCurrentColumn = _portfolioSortColumn == column;
    var arrow = isCurrentColumn ? (_portfolioSortAscending ? " ↑" : " ↓") : "";
    
    // 名称列左对齐，其他列居中对齐 ✨ 新增
    var alignment = column == "Name" ? TextAlignment.Left : TextAlignment.Center;
    var margin = column == "Name" ? new Thickness(5, 0, 5, 0) : new Thickness(0);
    
    var textBlock = new TextBlock
    {
        Text = title + arrow,
        FontWeight = FontWeights.Bold,
        FontSize = 12,
        Foreground = isCurrentColumn 
            ? new SolidColorBrush(Color.FromRgb(0, 120, 212)) 
            : new SolidColorBrush(Colors.DarkGray),
        TextAlignment = alignment,  // ✨ 修改：根据列类型设置对齐
        Cursor = System.Windows.Input.Cursors.Hand,
        Margin = margin  // ✨ 修改：根据列类型设置边距
    };
    
    // ... 其余代码 ...
}
```

## 📊 对齐规则

### 列对齐方式和边距统一标准

| 列名 | 对齐方式 | 边距 | 说明 |
|------|---------|------|------|
| 序号 | Center | 无 | 居中，无边距 |
| 组合名称 | **Left** | Margin(5,0,5,0) | 左对齐，左右各5px边距 |
| 24H涨幅 | Center | 无 | 居中，无边距 |
| 30天涨幅 | Center | 无 | 居中，无边距 |
| 数量 | Center | 无 | 居中，无边距 |
| 成交额 | Center | 无 | 居中，无边距 |
| 操作 | Center | 无 | 居中，无边距 |

### 为什么名称列左对齐？

1. **可读性**：文字内容左对齐更符合阅读习惯
2. **长度不一**：组合名称长度差异大，左对齐更整齐
3. **弹性宽度**：名称列使用弹性宽度，左对齐能更好地利用空间

## 🎨 修复前后对比

### 修复前（对齐错误）

```
┌──────┬──────────────────┬─────────┬─────────┬─────┬────────┬──────┐
│ 序号 │    组合名称      │ 24H涨幅 │ 30天涨幅│ 数量│ 成交额  │ 操作 │  ← 表头（名称居中）
├──────┼──────────────────┼─────────┼─────────┼─────┼────────┼──────┤
│  1   │ 经典主流           │ +2.5% ↑ │ +5.3% ↑ │ 4个 │ $120M  │ 改 删│  ← 内容（名称左对齐）
│  2   │ 次新潜力高成长...   │ +1.8% ↑ │ +3.2% ↑ │ 6个 │ $85M   │ 改 删│
└──────┴──────────────────┴─────────┴─────────┴─────┴────────┴──────┘
         ↑                   ↑
       错位                轻微错位
```

### 修复后（对齐正确）

```
┌──────┬──────────────────────────────┬─────────┬─────────┬─────┬────────┬──────┐
│ 序号 │ 组合名称                      │ 24H涨幅 │ 30天涨幅│ 数量│ 成交额  │ 操作 │  ← 表头（名称左对齐）
├──────┼──────────────────────────────┼─────────┼─────────┼─────┼────────┼──────┤
│  1   │ 经典主流                      │ +2.5% ↑ │ +5.3% ↑ │ 4个 │ $120M  │ 改 删│  ← 内容（名称左对齐）
│  2   │ 次新潜力高成长项目组合          │ +1.8% ↑ │ +3.2% ↑ │ 6个 │ $85M   │ 改 删│
│  3   │ 黑马板块                      │ -0.5% ↓ │ +2.1% ↑ │ 8个 │ $50M   │ 改 删│
└──────┴──────────────────────────────┴─────────┴─────────┴─────┴────────┴──────┘
         ✅                             ✅       ✅      ✅     ✅      ✅
       完美对齐                    所有列都完美对齐
```

## 🔧 技术实现

### 动态设置对齐方式

```csharp
// 根据列类型设置不同的对齐方式
var alignment = column == "Name" ? TextAlignment.Left : TextAlignment.Center;
```

**支持的列类型**：
- `"Name"` → Left（左对齐）
- `"Change24h"`, `"Change30d"`, `"Count"`, `"Volume"` → Center（居中对齐）

### 动态设置边距

```csharp
// 只有名称列有边距，其他列无边距
var margin = column == "Name" ? new Thickness(5, 0, 5, 0) : new Thickness(0);
```

**边距说明**：
- `Thickness(5, 0, 5, 0)` = 左5px, 上0px, 右5px, 下0px
- 左右边距避免名称文字贴边

## 🎯 测试要点

- [x] 名称列表头和内容左对齐
- [x] 其他列表头和内容居中对齐
- [x] 所有列的表头和内容纵向对齐（列宽一致）
- [x] 名称列的文字左右有5px边距
- [x] 其他列无边距，文字紧贴列边界（但居中）
- [x] 排序箭头显示在正确位置
- [x] 弹性宽度列（名称）能正常伸缩

## 📦 修改文件

- ✅ `src/BinanceApps.WPF/CustomPortfolioWindow.xaml.cs`
  - 第415-434行：`CreateSortablePortfolioHeader()` 方法

## 💡 设计原则

### 表格对齐的最佳实践

1. **文字内容 → 左对齐**
   - 姓名、名称、描述等文字内容
   - 符合阅读习惯，视线自然流动

2. **数值数据 → 右对齐或居中对齐**
   - 金额、百分比、数量等数值
   - 便于比较大小，小数点对齐

3. **图标/操作 → 居中对齐**
   - 按钮、图标、操作列
   - 视觉平衡，美观整洁

### 本项目的选择

- **名称列**：文字内容 → **左对齐** ✅
- **24H涨幅、30天涨幅**：百分比数据 → **居中对齐** ✅
- **数量**：数值 → **居中对齐** ✅
- **成交额**：金额 → **居中对齐** ✅
- **操作**：按钮 → **居中对齐** ✅

## 🎁 额外优化

### 可排序表头的视觉效果

- **当前排序列**：蓝色字体 `#0078D4`，带箭头 ↑/↓
- **非排序列**：深灰色 `DarkGray`
- **鼠标悬停**：浅蓝色 `#6496C8`，提示可点击
- **鼠标光标**：`Hand` 光标，增强交互感

### 排序箭头位置

排序箭头追加在表头文字后：
- `"组合名称 ↑"` - 升序
- `"24H涨幅 ↓"` - 降序

由于不同列的对齐方式不同：
- **名称列（左对齐）**：箭头在文字右侧
- **其他列（居中对齐）**：箭头在居中位置的右侧

---

**修复完成日期**: 2025-10-02  
**修复人**: AI Assistant  
**版本**: 1.0 