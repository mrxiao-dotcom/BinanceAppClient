# 市场涨幅分布 - 坐标轴和数据标签优化说明

## 📊 优化概述

对折线图的坐标轴和数据标签进行了全面优化，提升可读性和信息密度。

---

## ✨ 优化内容

### 1. 横坐标文字优化

**优化前**：
- ❌ 文字旋转-45度斜着显示
- ❌ 字体较小（11px）
- ❌ 不易阅读

**优化后**：
- ✅ 文字正向显示（不旋转）
- ✅ 字体增大到 13px
- ✅ 加粗显示（SemiBold）
- ✅ 显示位置下移
- ✅ 文字居中对齐

**代码变化**：
```csharp
// 优化前
var label = new TextBlock
{
    Text = name,
    FontSize = 11,
    FontWeight = FontWeights.Medium,
    Foreground = new SolidColorBrush(Color.FromRgb(80, 80, 80))
};
label.RenderTransform = new RotateTransform(-45);
Canvas.SetLeft(label, x - 5);
Canvas.SetTop(label, top + 5);

// 优化后
var label = new TextBlock
{
    Text = name,
    FontSize = 13,
    FontWeight = FontWeights.SemiBold,
    Foreground = new SolidColorBrush(Color.FromRgb(60, 60, 60)),
    TextAlignment = TextAlignment.Center
};
Canvas.SetLeft(label, x - 30);
Canvas.SetTop(label, top + 10);
```

---

### 2. 纵坐标文字优化

**优化前**：
- ❌ 字体较小（12px）
- ❌ 字重中等（Medium）

**优化后**：
- ✅ 字体增大到 14px
- ✅ 加粗显示（SemiBold）
- ✅ 颜色加深（RGB 80→60）
- ✅ 位置微调

**代码变化**：
```csharp
// 优化前
var label = new TextBlock
{
    Text = value.ToString(),
    FontSize = 12,
    FontWeight = FontWeights.Medium,
    Foreground = new SolidColorBrush(Color.FromRgb(80, 80, 80))
};
Canvas.SetLeft(label, left - 45);
Canvas.SetTop(label, y - 8);

// 优化后
var label = new TextBlock
{
    Text = value.ToString(),
    FontSize = 14,
    FontWeight = FontWeights.SemiBold,
    Foreground = new SolidColorBrush(Color.FromRgb(60, 60, 60))
};
Canvas.SetLeft(label, left - 50);
Canvas.SetTop(label, y - 10);
```

---

### 3. Y轴标题优化

**优化前**：
- ❌ 字体较小（11px）

**优化后**：
- ✅ 字体增大到 13px
- ✅ 颜色加深

**代码变化**：
```csharp
// 优化前
var yTitle = new TextBlock
{
    Text = "合约数量",
    FontSize = 11,
    FontWeight = FontWeights.Bold,
    Foreground = new SolidColorBrush(Color.FromRgb(80, 80, 80))
};

// 优化后
var yTitle = new TextBlock
{
    Text = "合约数量",
    FontSize = 13,
    FontWeight = FontWeights.Bold,
    Foreground = new SolidColorBrush(Color.FromRgb(60, 60, 60))
};
```

---

### 4. 数据点标签显示（新增）⭐

**功能**：在今天和昨天的折线上显示每个节点的数值

**显示规则**：
1. **今天的数据（dayIndex=0）**：
   - 字体：11px
   - 字重：Bold（加粗）
   - 颜色：继承折线颜色（深橙色）
   - 背景：半透明白色

2. **昨天的数据（dayIndex=1）**：
   - 字体：10px
   - 字重：**Bold（加粗）** ✅
   - 颜色：黑色
   - 背景：半透明白色

3. **其他日期**：
   - 不显示标签（避免图表过于拥挤）

4. **数值过滤**：
   - 只显示 count > 0 的数值
   - count = 0 的节点不显示标签

**代码实现**：
```csharp
// 为今天和昨天的数据点添加数字标签
if (dayIndex == 0 || dayIndex == 1)
{
    var range = ranges[i];
    var count = distribution.RangeCounts.ContainsKey(range) ? distribution.RangeCounts[range] : 0;

    if (count > 0) // 只显示非0的数值
    {
        var label = new TextBlock
        {
            Text = count.ToString(),
            FontSize = dayIndex == 0 ? 11 : 10,
            FontWeight = FontWeights.Bold, // 今天和昨天都加粗
            Foreground = dayIndex == 0 ? GetLineColor(dayIndex) : new SolidColorBrush(Colors.Black),
            Background = new SolidColorBrush(Color.FromArgb(200, 255, 255, 255)) // 半透明白色背景
        };
        Canvas.SetLeft(label, point.X - 10);
        Canvas.SetTop(label, point.Y - 22);
        chartCanvas.Children.Add(label);
    }
}
```

---

## 🎨 视觉效果对比

### 优化前
```
Y轴                         X轴标签（斜着显示）
↑                          < ╱  ╱  ╱  ╱
│  [折线图]               -50% -40% -30% ...
│  （字体小，看不清）
└──────────────────────────────────→
  （横坐标文字旋转-45度，不易阅读）
```

### 优化后
```
Y轴（14px加粗）
↑                           节点数字
│  [折线图]               ●152 ●98 ●65
│  （今天加粗橙色，昨天黑色）  ●143 ●89 ●52
│
└──────────────────────────────────→ X轴
  <-50%  -40%  -30%  -20%  ...
  （13px加粗，正向显示，易读）
```

---

## 📊 字体大小对比

| 元素 | 优化前 | 优化后 | 变化 |
|-----|-------|-------|-----|
| Y轴刻度 | 12px | 14px | +2px ✅ |
| Y轴标题 | 11px | 13px | +2px ✅ |
| X轴标签 | 11px | 13px | +2px ✅ |
| 今天数据标签 | - | 11px | 新增 ⭐ |
| 昨天数据标签 | - | 10px | 新增 ⭐ |

---

## 🎯 用户价值

### 1. 提升可读性
- **横坐标不旋转**：用户不需要歪头看
- **字体增大**：远距离也能看清
- **加粗显示**：关键信息更突出

### 2. 增强信息密度
- **数据点标签**：直接显示数值，无需悬停
- **今天突出显示**：加粗+彩色，一目了然
- **昨天参考显示**：黑色显示，方便对比

### 3. 优化对比体验
- **今天 vs 昨天**：
  - 今天：11px Bold 橙色
  - 昨天：10px Normal 黑色
  - 对比清晰，层次分明

### 4. 避免视觉混乱
- **只显示今天和昨天**：5天数据都显示会太拥挤
- **过滤0值**：减少无效标签
- **半透明背景**：确保标签清晰可见

---

## 📐 位置调整

### X轴标签位置
```csharp
// 优化前（斜着显示，靠上）
Canvas.SetLeft(label, x - 5);
Canvas.SetTop(label, top + 5);

// 优化后（正向显示，居中下移）
Canvas.SetLeft(label, x - 30);  // 向左偏移30px，实现居中
Canvas.SetTop(label, top + 10);  // 向下偏移10px，留出空间
```

### Y轴标签位置
```csharp
// 优化前
Canvas.SetLeft(label, left - 45);
Canvas.SetTop(label, y - 8);

// 优化后（为更大字体留出空间）
Canvas.SetLeft(label, left - 50);  // 向左多5px
Canvas.SetTop(label, y - 10);      // 向上多2px
```

### 数据点标签位置
```csharp
// 显示在数据点上方
Canvas.SetLeft(label, point.X - 10);  // 居中
Canvas.SetTop(label, point.Y - 22);   // 上方22px
```

---

## 🎨 配色方案

### 坐标轴文字
**颜色**：RGB(60, 60, 60)
- 优化前：RGB(80, 80, 80)
- 更深的灰色，对比度更高

### 今天的数据标签
**颜色**：继承折线颜色
- dayIndex = 0 → RGB(255, 87, 34)（深橙色）
- 与折线颜色一致，视觉统一

### 昨天的数据标签
**颜色**：Colors.Black
- 黑色显示，与今天的橙色形成对比
- 清晰可见但不抢眼

### 标签背景
**颜色**：RGBA(255, 255, 255, 200)
- 半透明白色
- Alpha = 200（约78%不透明度）
- 确保标签文字清晰可见，不被折线遮挡

---

## 🧪 测试验证

### 视觉验证
✅ **验证步骤**：
1. 运行程序
2. 打开"市场每日涨幅分布"窗口
3. 观察折线图

✅ **预期结果**：
- 横坐标文字正向显示（不斜）
- 所有坐标轴文字都增大了
- 今天的折线（深橙色粗线）上每个节点都有数字
- 昨天的折线（橙色虚线）上每个节点都有黑色数字
- 今天的数字加粗，昨天的数字正常
- 数字都有半透明白色背景

---

### 功能验证
✅ **验证步骤**：
1. 查看今天的数据标签
2. 查看昨天的数据标签
3. 确认其他日期没有标签

✅ **预期结果**：
- 今天：11px Bold 橙色数字
- 昨天：10px Normal 黑色数字
- 前3天：无数字标签
- 所有数字只显示非0值

---

### 可读性验证
✅ **验证步骤**：
1. 站在屏幕1米外
2. 观察能否清楚看到坐标轴文字

✅ **预期结果**：
- 横坐标文字易读（不需要歪头）
- 纵坐标数字清晰
- 数据点标签清晰可见

---

## 📊 数据标签示例

### 示例数据
假设今天的分布：
```
<-50%:     5个
-49~-40%:  12个
-39~-30%:  35个
-29~-20%:  68个
-19~-10%: 142个
-9~0%:    189个
0~10%:    223个   ← 峰值
11~20%:   167个
21~30%:    98个
31~40%:    45个
41~50%:    12个
>50%:       4个
```

### 视觉呈现
```
Y轴
↑
│       223
│       ●
│      ╱ ╲    今天的折线（深橙色粗线，节点有加粗橙色数字）
│   189╱   ╲167
│   ●        ●
│  ╱          ╲
│ ●            ●98
│142            
│●              
│
└────────────────────────────────→ X轴
  -19~-10% -9~0% 0~10% 11~20% ...
```

---

## 🔄 与之前功能的协调

### 与0%分界线的配合
- ✅ 0%分界线（青绿色虚线）在后面绘制
- ✅ 数据标签在前面显示
- ✅ 标签不会被分界线遮挡

### 与网格线的配合
- ✅ 网格线（浅灰色虚线）在最底层
- ✅ 折线和标签在上层
- ✅ 层次清晰

### 绘制顺序
```
1. 网格线（最底层）
2. 0%分界线
3. 折线（Polyline）
4. 数据点（Ellipse）
5. 数据点标签（TextBlock）（最上层）
```

---

## 🎯 使用场景

### 场景 1：快速查看今日数据
**问题**：今天各档位有多少合约？

**方法**：
1. 查看深橙色粗线（今天）
2. 直接读取节点上的加粗橙色数字
3. 无需悬停或点击

---

### 场景 2：今昨对比
**问题**：今天比昨天变化如何？

**方法**：
1. 今天：加粗橙色数字
2. 昨天：黑色数字
3. 同一档位上下对比
4. 快速判断趋势

**示例**：
```
0~10%档位：
今天：223（加粗橙色）
昨天：198（黑色）
→ 涨幅0~10%的合约增加了25个
```

---

### 场景 3：识别峰值
**问题**：今天涨跌分布的峰值在哪？

**方法**：
1. 查看今天折线上数字最大的节点
2. 加粗橙色显示，非常醒目
3. 快速定位市场主力区间

---

### 场景 4：趋势判断
**问题**：市场情绪是否改善？

**方法**：
1. 对比今昨两天的峰值位置
2. 峰值向右移 → 市场转暖
3. 峰值向左移 → 市场转冷

---

## 🔧 技术细节

### 循环改造
**优化前**：
```csharp
foreach (var point in points)
{
    // 只能访问 point，无法知道索引
}
```

**优化后**：
```csharp
for (int i = 0; i < points.Count; i++)
{
    var point = points[i];
    // 可以通过 i 访问对应的 range 和 count
}
```

**原因**：需要通过索引 `i` 来获取对应档位的 `count` 值。

---

### 条件判断
```csharp
if (dayIndex == 0 || dayIndex == 1)
{
    // 只为今天和昨天添加标签
}
```

**说明**：
- `dayIndex = 0`：今天（24H数据）
- `dayIndex = 1`：昨天
- `dayIndex = 2~4`：前3天（不显示标签）

---

### 动态样式
```csharp
FontSize = dayIndex == 0 ? 11 : 10,
FontWeight = FontWeights.Bold, // 今天和昨天都加粗
Foreground = dayIndex == 0 ? GetLineColor(dayIndex) : new SolidColorBrush(Colors.Black),
```

**说明**：
- 三元运算符实现今天和昨天的差异化样式
- 今天：更大（11px）、加粗、橙色
- 昨天：较小（10px）、**加粗**、黑色 ✅

---

## 📝 修改文件清单

| 文件 | 修改内容 | 行数变化 |
|-----|---------|---------|
| `MarketDistributionWindow.xaml.cs` | Y轴标签增大 | 修改 5行 |
| `MarketDistributionWindow.xaml.cs` | X轴标签增大+去旋转 | 修改 10行 |
| `MarketDistributionWindow.xaml.cs` | 添加数据点标签 | 新增 20行 |

**总计**：1个文件，约35行代码修改

---

## ✅ 完成清单

- [x] Y轴标签字体从12px增大到14px
- [x] Y轴标题字体从11px增大到13px
- [x] X轴标签字体从11px增大到13px
- [x] X轴标签去掉旋转（正向显示）
- [x] 今天的数据点添加数字标签（11px Bold 橙色）
- [x] 昨天的数据点添加数字标签（10px **Bold** 黑色）✅
- [x] 标签过滤0值
- [x] 标签添加半透明白色背景
- [x] 编译测试通过

---

## 🔄 后续优化建议

### 1. 智能标签位置
**功能**：根据数据点位置自动调整标签显示位置
```
- 数据点在上半区 → 标签显示在下方
- 数据点在下半区 → 标签显示在上方
- 避免标签超出图表区域
```

### 2. 标签背景优化
**功能**：根据背景自动调整标签样式
```
- 背景浅色 → 深色边框
- 背景深色 → 浅色边框
- 提升标签可见性
```

### 3. 可配置显示
**功能**：允许用户选择显示哪些天的标签
```
- 复选框：今天 ☑  昨天 ☑  3天前 ☐ ...
- 用户自定义显示规则
```

### 4. 数据点悬停
**功能**：鼠标悬停显示详细信息
```
Tooltip:
日期：2025-10-05
档位：0~10%
数量：223个
占比：18.5%
```

---

**功能版本**: 1.0.4  
**优化日期**: 2025-10-05  
**开发者**: AI Assistant  
**状态**: ✅ 已完成并通过编译测试

