# 组合分组功能说明

## ✨ 功能概述

为了方便管理大量组合，新增**组合分组**功能。用户可以将组合归类到不同的分组（如：经典组、次新组、黑马组等），通过点击分组标签快速筛选和查看。

---

## 📋 功能特性

### 1. 分组标签栏

**位置**：组合列表区域上方

**样式**：胶囊形状的标签按钮

**显示内容**：
- 分组名称
- 该分组下的组合数量

**示例**：
```
[全部 (12)] [经典组 (5)] [次新组 (3)] [黑马组 (4)]
```

### 2. 分组筛选

**交互**：点击分组标签 → 仅显示该分组下的组合

**"全部"标签**：显示所有组合（默认状态）

**空分组提示**：当某分组无组合时，显示提示文本

### 3. 预设分组

系统预设了6个常用分组（可自定义添加）：

| 分组名称 | 说明 | 适用场景 |
|---------|------|---------|
| 默认分组 | 系统默认，未指定分组时使用 | 临时或未分类的组合 |
| 经典组 | 长期稳定的蓝筹币种 | BTC、ETH等主流币 |
| 次新组 | 近期上线的新币种 | 新上线但有潜力的币种 |
| 黑马组 | 已经表现出强势的币种 | 短期涨幅较大的币种 |
| 潜力组 | 看好但尚未爆发的币种 | 长期持有的潜力币 |
| 观察组 | 需要持续关注的币种 | 处于关键价位的币种 |

**支持自定义**：在"所属分组"下拉框中可以直接输入新的分组名称

---

## 🎨 UI设计

### 标签样式

**未选中状态**：
- 背景：白色
- 边框：蓝色 (#0078D4)
- 文字：蓝色 (#0078D4)
- 鼠标悬停：浅蓝色背景 (#E6F0FF)

**选中状态**：
- 背景：蓝色 (#0078D4)
- 边框：蓝色 (#0078D4)
- 文字：白色
- 字体：加粗

**布局**：
```
┌─────────────────────────────────────┐
│         组合列表                      │
├─────────────────────────────────────┤
│ [全部(12)] [经典组(5)] [次新组(3)]   │ ← 分组标签栏
├─────────────────────────────────────┤
│ 组合1 - 经典组                        │
│ 组合2 - 经典组                        │
│ 组合3 - 经典组                        │
│ ...                                  │
└─────────────────────────────────────┘
```

---

## 🛠️ 使用方法

### 1. 创建组合时指定分组

**步骤**：
1. 点击"创建组合"按钮
2. 填写组合名称和说明
3. 在"所属分组"下拉框中选择或输入分组名称
4. 添加合约
5. 点击"保存"

**截图示例**：
```
┌─────────────────────────────────────────┐
│ 创建组合                                 │
├─────────────────────────────────────────┤
│ 组合名称: [DeFi蓝筹              ]      │
│                                          │
│ 组合说明: [                      ]  分组: [经典组  ▼]
│           [                      ]      │
│           [                      ]      │
│                                          │
│ ...                                     │
└─────────────────────────────────────────┘
```

### 2. 修改组合分组

**步骤**：
1. 点击组合右侧的"修"按钮
2. 在"所属分组"下拉框中修改分组
3. 点击"保存"

### 3. 切换分组查看

**步骤**：
1. 打开"自定义板块监控"窗口
2. 在组合列表上方的标签栏中点击要查看的分组
3. 列表自动筛选显示该分组下的组合

**效果**：
- 点击"经典组" → 仅显示经典组的5个组合
- 点击"全部" → 显示所有12个组合
- 点击"次新组" → 仅显示次新组的3个组合

---

## 📊 数据结构

### CustomPortfolio 模型新增字段

```csharp
/// <summary>
/// 分组名称（如：经典组、次新组、黑马组）
/// </summary>
public string GroupName { get; set; } = "默认分组";
```

### JSON 存储格式

```json
{
  "Version": "1.0",
  "LastUpdated": "2025-10-02T...",
  "Portfolios": [
    {
      "Id": "guid-1",
      "Name": "DeFi蓝筹",
      "Description": "稳定的DeFi项目",
      "GroupName": "经典组",
      "Symbols": [...]
    },
    {
      "Id": "guid-2",
      "Name": "Layer2新星",
      "Description": "新兴Layer2项目",
      "GroupName": "次新组",
      "Symbols": [...]
    }
  ]
}
```

---

## 🔧 技术实现

### 1. 数据模型扩展

**文件**: `src/BinanceApps.Core/Models/CustomPortfolio.cs`

**修改**：给 `CustomPortfolio` 类添加 `GroupName` 属性，默认值为 "默认分组"

### 2. Service 层更新

**文件**: `src/BinanceApps.Core/Services/CustomPortfolioService.cs`

**修改**：
- `CreatePortfolioAsync` 方法增加 `groupName` 参数
- `UpdatePortfolioAsync` 方法增加 `groupName` 参数

### 3. UI 实现

**文件**: `src/BinanceApps.WPF/CustomPortfolioWindow.xaml`

**新增**：
- 分组标签栏 (`panelGroupTabs`)
- 横向滚动支持

**文件**: `src/BinanceApps.WPF/CustomPortfolioWindow.xaml.cs`

**新增**：
- `_currentGroupFilter` 字段：当前选中的分组
- `UpdateGroupTabs()` 方法：更新分组标签栏
- `CreateGroupTab()` 方法：创建单个分组标签
- `DisplayPortfoliosList()` 方法增强：支持分组筛选

### 4. 编辑对话框更新

**文件**: `src/BinanceApps.WPF/PortfolioEditorDialog.xaml`

**新增**：
- 分组选择下拉框 (`cmbGroupName`)
- 预设6个常用分组选项
- 支持自定义输入新分组名称

**文件**: `src/BinanceApps.WPF/PortfolioEditorDialog.xaml.cs`

**修改**：
- `Window_Loaded` 方法：加载现有组合的分组信息
- `BtnSave_Click` 方法：保存时包含分组信息

---

## 🎯 使用场景

### 场景 1：按投资策略分组

**分组设计**：
- **长线组**：长期持有的币种（BTC、ETH）
- **波段组**：适合波段操作的币种（高波动率）
- **定投组**：定期定额投资的币种

**优势**：清晰区分不同的投资策略和持仓目的

### 场景 2：按市场热度分组

**分组设计**：
- **热门组**：近期市场热度高的币种
- **冷门组**：被市场忽视的潜力币种
- **稳健组**：波动较小的稳定币种

**优势**：快速识别市场机会和风险

### 场景 3：按生态分组

**分组设计**：
- **以太坊生态**：ETH、各种Layer2
- **BSC生态**：BNB及BSC链上项目
- **Solana生态**：SOL及Solana链上项目

**优势**：从生态视角观察资金流向

### 场景 4：按操作状态分组

**分组设计**：
- **持仓组**：当前持有的币种
- **关注组**：计划买入的币种
- **止盈组**：准备卖出的币种

**优势**：管理交易计划和执行

---

## 🧪 测试验证

### 测试步骤

1. **创建不同分组的组合**
   ```
   - 创建3个"经典组"组合
   - 创建2个"次新组"组合
   - 创建1个"黑马组"组合
   ```

2. **验证分组标签显示**
   - ✅ 检查是否显示"全部 (6)"
   - ✅ 检查是否显示"经典组 (3)"
   - ✅ 检查是否显示"次新组 (2)"
   - ✅ 检查是否显示"黑马组 (1)"

3. **验证分组筛选**
   - ✅ 点击"经典组"，只显示3个组合
   - ✅ 点击"次新组"，只显示2个组合
   - ✅ 点击"全部"，显示所有6个组合

4. **验证修改分组**
   - ✅ 修改一个组合的分组
   - ✅ 检查标签栏数量是否更新
   - ✅ 检查筛选结果是否正确

5. **验证自定义分组**
   - ✅ 输入新分组名称"潜力组"
   - ✅ 保存后检查是否出现新标签
   - ✅ 检查筛选功能是否正常

### 预期结果

**正常情况**：
```
分组标签栏:
[全部 (6)] [经典组 (3)] [次新组 (2)] [黑马组 (1)]

点击"经典组"后：
  DeFi蓝筹 - 经典组
  主流币种 - 经典组
  稳健组合 - 经典组
```

**空分组情况**：
```
点击"观察组"（无组合）：
  「观察组」分组暂无组合
```

---

## ⚠️ 注意事项

### 1. 分组名称

- ✅ 支持中文和英文
- ✅ 长度建议不超过10个字符
- ✅ 避免使用特殊字符

### 2. 数据兼容性

**旧数据处理**：
- 未设置分组的旧组合自动归入"默认分组"
- 不影响现有功能和数据

### 3. 分组管理

**当前限制**：
- 不支持删除分组（分组会随最后一个组合的删除而自动消失）
- 不支持重命名分组（需要逐个修改组合的分组属性）

**未来优化方向**：
- 添加分组管理界面
- 支持批量修改组合分组
- 支持分组排序

---

## 📝 常见问题

### Q1：如何删除一个分组？

**A**: 将该分组下的所有组合移动到其他分组或删除，该分组会自动消失。

### Q2：可以创建多少个分组？

**A**: 理论上无限制，但建议不超过10个分组，以保持界面简洁。

### Q3：分组数据存储在哪里？

**A**: 存储在 `%LocalAppData%\BinanceApps\custom_portfolios.json` 文件中，作为组合数据的一部分。

### Q4：修改分组后，历史数据会丢失吗？

**A**: 不会。只有分组信息会更新，组合的其他数据（名称、说明、合约列表）保持不变。

### Q5：分组标签太多怎么办？

**A**: 分组标签栏支持横向滚动，可以左右滑动查看所有标签。

---

## 🚀 后续计划

### 可能的功能扩展

1. **分组管理界面**
   - 统一管理所有分组
   - 支持分组重命名
   - 支持分组排序

2. **批量操作**
   - 批量修改组合分组
   - 分组间批量移动组合

3. **分组统计**
   - 显示各分组的总体表现
   - 分组级别的涨跌统计

4. **分组导出**
   - 按分组导出组合数据
   - 分组级别的报表生成

---

**功能版本**: 1.0.8  
**实现日期**: 2025-10-02  
**测试状态**: ✅ 待验证  
**相关文档**: `组合监控30天数据功能说明.md` 