# 更新功能详细日志输出说明

## 📊 完整的日志输出示例

### 阶段 1：检查更新

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 开始检查更新
   服务器: http://192.168.1.101:8080
   应用ID: App_20250928132921
   应用名称: BinanceApps
   当前版本: 1.0.1
   检查 URL: http://192.168.1.101:8080/api/update/check?appId=App_20250928132921&currentVersion=1.0.1
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📡 更新检查响应 (耗时: 125 ms)
   IsSuccess: True
   HasUpdate: True
```

**说明**：
- 显示服务器地址和连接信息
- 显示完整的检查 URL（可直接在浏览器测试）
- 显示响应时间和结果

### 阶段 2：发现新版本

```
📦 发现新版本: 1.0.2
📥 下载 URL: '/api/update/download/App_20250928132921/1.0.2'
📊 文件大小: 3.82 MB
🔐 MD5: 
🔒 强制更新: False
✓ URL 类型: 相对路径
🔧 相对路径将使用 BaseAddress: http://192.168.1.101:8080
```

**说明**：
- 显示新版本号
- 显示下载 URL（相对或绝对）
- 显示文件大小和 MD5 状态
- 显示 URL 类型判断

### 阶段 3：预下载和 MD5 计算（如果服务器没有提供 MD5）

```
⚠️ 警告：服务器未提供 MD5
⚠️ 将先下载文件并计算实际 MD5 值
📥 预下载文件以计算 MD5...
   下载地址: http://192.168.1.101:8080/api/update/download/App_20250928132921/1.0.2
   临时位置: C:\Users\Admin\AppData\Local\Temp\update_1.0.2_a1b2c3d4.zip
   文件大小: 3.82 MB
   发送下载请求...
   响应状态: 200 OK
   开始接收数据，总大小: 3.82 MB
   进度: 10% (0.38/3.82 MB) - 速度: 2.45 MB/s
   进度: 20% (0.76/3.82 MB) - 速度: 2.51 MB/s
   进度: 30% (1.15/3.82 MB) - 速度: 2.48 MB/s
   进度: 40% (1.53/3.82 MB) - 速度: 2.50 MB/s
   进度: 50% (1.91/3.82 MB) - 速度: 2.49 MB/s
   进度: 60% (2.29/3.82 MB) - 速度: 2.47 MB/s
   进度: 70% (2.67/3.82 MB) - 速度: 2.48 MB/s
   进度: 80% (3.06/3.82 MB) - 速度: 2.46 MB/s
   进度: 90% (3.44/3.82 MB) - 速度: 2.47 MB/s
   进度: 100% (3.82/3.82 MB) - 速度: 2.48 MB/s
✅ 预下载完成！
   下载大小: 3.82 MB
   耗时: 1.5 秒
   平均速度: 2.48 MB/s
🔐 计算文件 MD5...
✅ 计算的 MD5: 1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p
🔧 已使用实际 MD5 值
```

**说明**：
- 显示完整的下载地址
- 显示临时文件位置
- **实时显示下载进度**（每 10% 更新一次）
- **显示下载速度**（实时和平均）
- 显示 HTTP 响应状态
- 显示计算出的 MD5 值

### 阶段 4：正式下载和安装

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⬇️  开始正式下载并安装更新...
   下载地址: http://192.168.1.101:8080/api/update/download/App_20250928132921/1.0.2
   版本: 1.0.2
   文件大小: 3.82 MB
   MD5: 1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p
   HttpClient BaseAddress: http://192.168.1.101:8080
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

（RegisterSrv.AutoUpdate 的内部下载过程）

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 下载和安装完成
   结果: ✅ 成功
   总耗时: 3.2 秒
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 更新安装成功
```

**说明**：
- 显示最终下载地址和 MD5
- 显示安装结果
- 显示总耗时

### 阶段 5：完成

```
（弹出重启提示对话框）
🔄 重启应用程序...
```

---

## 🔍 详细信息说明

### 1. 下载进度显示

**格式**：
```
进度: XX% (已下载/总大小 MB) - 速度: X.XX MB/s
```

**更新频率**：每 10% 显示一次

**计算方式**：
- 进度 = (已下载字节数 / 总字节数) × 100%
- 速度 = 已下载字节数 / 已用时间

### 2. HTTP 响应状态

**常见状态码**：
- `200 OK` - 成功
- `404 Not Found` - 文件不存在
- `500 Internal Server Error` - 服务器错误

### 3. 文件大小显示

所有文件大小都以 **MB** 为单位，保留 2 位小数。

### 4. 时间显示

- **毫秒 (ms)**：用于快速操作（如检查更新）
- **秒 (s)**：用于较长操作（如下载）

### 5. MD5 显示

- **32 位十六进制字符串**
- 如果为空，会触发预下载和计算流程

---

## 🎯 如何使用这些日志

### 诊断网络问题

查看：
- `响应状态` - 是否为 200
- `下载速度` - 是否过慢
- `耗时` - 是否超时

### 诊断服务器问题

查看：
- `检查 URL` - 可以在浏览器中直接测试
- `下载地址` - 可以在浏览器中直接测试
- `响应状态` - 404 表示文件不存在

### 诊断文件问题

查看：
- `文件大小` - 是否匹配预期
- `MD5` - 是否正确计算
- `临时位置` - 可以手动检查临时文件

### 性能分析

查看：
- `更新检查响应` 时间 - 网络延迟
- `平均速度` - 下载带宽
- `总耗时` - 整体性能

---

## 📋 完整流程示例

### 成功的更新流程

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 开始检查更新
   服务器: http://192.168.1.101:8080
   应用ID: App_20250928132921
   应用名称: BinanceApps
   当前版本: 1.0.1
   检查 URL: http://192.168.1.101:8080/api/update/check?appId=App_20250928132921&currentVersion=1.0.1
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📡 更新检查响应 (耗时: 125 ms)
   IsSuccess: True
   HasUpdate: True
📦 发现新版本: 1.0.2
📥 下载 URL: '/api/update/download/App_20250928132921/1.0.2'
📊 文件大小: 3.82 MB
🔐 MD5: 
🔒 强制更新: False
✓ URL 类型: 相对路径
🔧 相对路径将使用 BaseAddress: http://192.168.1.101:8080
⚠️ 警告：服务器未提供 MD5
⚠️ 将先下载文件并计算实际 MD5 值
📥 预下载文件以计算 MD5...
   下载地址: http://192.168.1.101:8080/api/update/download/App_20250928132921/1.0.2
   临时位置: C:\Users\Admin\AppData\Local\Temp\update_1.0.2_xxx.zip
   文件大小: 3.82 MB
   发送下载请求...
   响应状态: 200 OK
   开始接收数据，总大小: 3.82 MB
   进度: 10% (0.38/3.82 MB) - 速度: 2.45 MB/s
   进度: 20% (0.76/3.82 MB) - 速度: 2.51 MB/s
   ...
   进度: 100% (3.82/3.82 MB) - 速度: 2.48 MB/s
✅ 预下载完成！
   下载大小: 3.82 MB
   耗时: 1.5 秒
   平均速度: 2.48 MB/s
🔐 计算文件 MD5...
✅ 计算的 MD5: 1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p
🔧 已使用实际 MD5 值
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
⬇️  开始正式下载并安装更新...
   下载地址: http://192.168.1.101:8080/api/update/download/App_20250928132921/1.0.2
   版本: 1.0.2
   文件大小: 3.82 MB
   MD5: 1a2b3c4d5e6f7g8h9i0j1k2l3m4n5o6p
   HttpClient BaseAddress: http://192.168.1.101:8080
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📋 下载和安装完成
   结果: ✅ 成功
   总耗时: 3.2 秒
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ 更新安装成功
```

---

## 💡 提示

1. **保存日志**：可以将输出窗口的内容复制保存，便于后续分析
2. **查找关键信息**：使用 `━━━` 作为分隔符快速定位各个阶段
3. **关注错误**：查找 `❌` 和 `⚠️` 符号
4. **验证 URL**：复制 `检查 URL` 和 `下载地址` 到浏览器测试

---

**版本**：2.0  
**更新日期**：2025-09-30  
**特性**：完整的下载进度、速度和时间统计 