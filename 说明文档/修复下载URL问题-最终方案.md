# ä¿®å¤ä¸‹è½½ URL é—®é¢˜ - æœ€ç»ˆæ–¹æ¡ˆ

## ğŸ¯ é—®é¢˜æè¿°

ä¸‹è½½æ›´æ–°æ—¶å‡ºç°é”™è¯¯ï¼š
```
An invalid request URI was provided. Either the request URI must be an absolute URI or BaseAddress must be set
```

**æ ¹æœ¬åŸå› **ï¼š
- æœåŠ¡å™¨è¿”å›çš„ä¸‹è½½ URL æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ `/api/update/download/xxx.zip`ï¼‰
- HttpClient åœ¨ä¸‹è½½æ—¶éœ€è¦ç»å¯¹ URL æˆ–è®¾ç½® BaseAddress

## âœ… è§£å†³æ–¹æ¡ˆ

åˆ›å»ºäº† `FixedUpdateManager` ç±»ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼è§£å†³é—®é¢˜ï¼š

### æ ¸å¿ƒä¿®å¤ç‚¹

1. **è®¾ç½® HttpClient çš„ BaseAddress**
   ```csharp
   var httpClient = new System.Net.Http.HttpClient
   {
       BaseAddress = new Uri("http://192.168.1.101:8080"),
       Timeout = TimeSpan.FromMinutes(10)
   };
   ```

2. **ä¼ é€’è‡ªå®šä¹‰ HttpClient ç»™ UpdateClient**
   ```csharp
   _updateClient = new UpdateClient(config.ServerUrl, config.AppId, httpClient);
   ```

3. **æ·»åŠ è¯¦ç»†è°ƒè¯•è¾“å‡º**
   - è¾“å‡ºä¸‹è½½ URLï¼ˆå®Œæ•´è·¯å¾„ï¼‰
   - è¾“å‡º URL ç±»å‹ï¼ˆç»å¯¹/ç›¸å¯¹ï¼‰
   - è¾“å‡º BaseAddress é…ç½®
   - è¾“å‡ºè¯¦ç»†çš„å¼‚å¸¸ä¿¡æ¯

## ğŸ“ å·²ä¿®æ”¹çš„æ–‡ä»¶

### 1. æ–°å»ºæ–‡ä»¶ï¼š`src/BinanceApps.WPF/FixedUpdateManager.cs`
- æ›¿ä»£ `UpdateManager` çš„åŒ…è£…ç±»
- è‡ªåŠ¨è®¾ç½® HttpClient BaseAddress
- è¾“å‡ºè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

### 2. ä¿®æ”¹ï¼š`src/BinanceApps.WPF/App.xaml.cs`
- å°† `UpdateManager` ç±»å‹æ”¹ä¸º `FixedUpdateManager`
- åˆå§‹åŒ–æ—¶ä½¿ç”¨ `new FixedUpdateManager(updateConfig)`

### 3. `src/BinanceApps.WPF/MainWindow.xaml.cs`
- å·²æ·»åŠ è¯¦ç»†çš„å¼‚å¸¸æ—¥å¿—è¾“å‡º
- ä¸éœ€è¦é¢å¤–ä¿®æ”¹ï¼ˆå…¼å®¹æ–°æ¥å£ï¼‰

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### 1. åœ¨ Visual Studio ä¸­é‡æ–°ç”Ÿæˆ

```
1. æ‰“å¼€ Visual Studio
2. ç”Ÿæˆ â†’ é‡æ–°ç”Ÿæˆè§£å†³æ–¹æ¡ˆ
3. ç¡®è®¤æ— ç¼–è¯‘é”™è¯¯
```

### 2. è¿è¡Œåº”ç”¨ç¨‹åº

```
1. æŒ‰ F5 å¯åŠ¨åº”ç”¨
2. ä¸»çª—å£åº”è¯¥æ­£å¸¸æ˜¾ç¤º
3. ç­‰å¾… 2 ç§’åå°æ£€æŸ¥æ›´æ–°
```

### 3. æ‰‹åŠ¨æµ‹è¯•æ›´æ–°

```
1. ç‚¹å‡»èœå•ï¼šå¸®åŠ© â†’ æ£€æŸ¥æ›´æ–°
2. å¦‚æœæœ‰æ–°ç‰ˆæœ¬ï¼Œç‚¹å‡»"ç«‹å³æ›´æ–°"
3. æŸ¥çœ‹è¾“å‡ºçª—å£çš„è°ƒè¯•ä¿¡æ¯
```

## ğŸ“Š é¢„æœŸçš„è°ƒè¯•è¾“å‡º

å¯åŠ¨æ—¶ï¼š
```
âœ… FixedUpdateManager å·²åˆå§‹åŒ–
   BaseAddress: http://192.168.1.101:8080
```

æ£€æŸ¥æ›´æ–°æ—¶ï¼š
```
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ” å¼€å§‹æ£€æŸ¥æ›´æ–°
   æœåŠ¡å™¨: http://192.168.1.101:8080
   åº”ç”¨ID: App_20250928132921
   å½“å‰ç‰ˆæœ¬: 1.0.1
ğŸ“¦ å‘ç°æ–°ç‰ˆæœ¬: 1.0.2
ğŸ“¥ ä¸‹è½½ URL: '/api/update/download/xxx.zip'
ğŸ“Š æ–‡ä»¶å¤§å°: 15.23 MB
ğŸ” MD5: xxxxx
ğŸ”’ å¼ºåˆ¶æ›´æ–°: False
âœ“ URL ç±»å‹: ç›¸å¯¹è·¯å¾„
ğŸ”§ ç›¸å¯¹è·¯å¾„å°†ä½¿ç”¨ BaseAddress: http://192.168.1.101:8080
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
```

ä¸‹è½½æ—¶ï¼š
```
â¬‡ï¸  å¼€å§‹ä¸‹è½½æ›´æ–°...
   å®é™…è¯·æ±‚çš„ URL: /api/update/download/xxx.zip
   HttpClient BaseAddress: http://192.168.1.101:8080
âœ… æ›´æ–°å®‰è£…æˆåŠŸ
```

## ğŸ” æ•…éšœæ’æŸ¥

### å¦‚æœè¿˜æ˜¯æŠ¥åŒæ ·çš„é”™è¯¯

æŸ¥çœ‹è¾“å‡ºçª—å£ä¸­çš„ï¼š
- **ä¸‹è½½ URL**: ç¡®è®¤æ˜¯ä»€ä¹ˆæ ¼å¼
- **URL ç±»å‹**: æ˜¯ç»å¯¹è·¯å¾„è¿˜æ˜¯ç›¸å¯¹è·¯å¾„
- **BaseAddress**: ç¡®è®¤æ˜¯å¦æ­£ç¡®è®¾ç½®

### å¦‚æœä¸‹è½½å¤±è´¥

å¯èƒ½çš„åŸå› ï¼š
1. æœåŠ¡å™¨ä¸Šçš„æ›´æ–°åŒ…æ–‡ä»¶ä¸å­˜åœ¨
2. ç½‘ç»œè¿æ¥é—®é¢˜
3. æƒé™é—®é¢˜

è§£å†³æ–¹æ³•ï¼š
1. åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è®¿é—®å®Œæ•´çš„ä¸‹è½½ URL
2. æ£€æŸ¥æœåŠ¡å™¨æ—¥å¿—
3. ç¡®è®¤æ–‡ä»¶è·¯å¾„æ­£ç¡®

## ğŸ’¡ å·¥ä½œåŸç†

### ä¸ºä»€ä¹ˆè®¾ç½® BaseAddress å¯ä»¥è§£å†³é—®é¢˜ï¼Ÿ

å½“æœåŠ¡å™¨è¿”å›ç›¸å¯¹ URL æ—¶ï¼ˆå¦‚ `/api/update/download/file.zip`ï¼‰ï¼ŒHttpClient éœ€è¦çŸ¥é“åŸºç¡€åœ°å€æ‰èƒ½æ„å»ºå®Œæ•´ URLï¼š

```
ç›¸å¯¹ URL: /api/update/download/file.zip
BaseAddress: http://192.168.1.101:8080
å®é™…è¯·æ±‚: http://192.168.1.101:8080/api/update/download/file.zip
```

å¦‚æœæ²¡æœ‰è®¾ç½® BaseAddressï¼ŒHttpClient æ— æ³•æ„å»ºå®Œæ•´ URLï¼Œå°±ä¼šæŠ¥é”™ã€‚

### RegisterSrv.AutoUpdate çš„è®¾è®¡

`UpdateClient` æ„é€ å‡½æ•°æ”¯æŒä¼ å…¥è‡ªå®šä¹‰ HttpClientï¼š
```csharp
public UpdateClient(string baseUrl, string appId, HttpClient? httpClient = null)
```

æˆ‘ä»¬åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œä¼ å…¥ä¸€ä¸ªå·²é…ç½® BaseAddress çš„ HttpClientã€‚

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. **BaseAddress å¿…é¡»ä»¥ `/` ç»“å°¾æˆ–ç›¸å¯¹ URL å¿…é¡»ä»¥ `/` å¼€å¤´**
   - æˆ‘ä»¬çš„ä»£ç å·²å¤„ç†ï¼š`_serverUrl.TrimEnd('/')`
   - ç›¸å¯¹ URL æ£€æŸ¥ï¼š`if (!downloadUrl.StartsWith("/"))`

2. **è¶…æ—¶æ—¶é—´è®¾ç½®ä¸º 10 åˆ†é’Ÿ**
   - é€‚ç”¨äºå¤§æ–‡ä»¶ä¸‹è½½
   - å¦‚éœ€è°ƒæ•´ï¼Œä¿®æ”¹ `Timeout = TimeSpan.FromMinutes(10)`

3. **å…¼å®¹æ€§**
   - åŒæ—¶æ”¯æŒç›¸å¯¹ URL å’Œç»å¯¹ URL
   - å¦‚æœæœåŠ¡å™¨è¿”å›ç»å¯¹ URLï¼ŒBaseAddress ä¸å½±å“

## âœ¨ é¢å¤–æ”¹è¿›

é™¤äº†ä¿®å¤ URL é—®é¢˜ï¼Œè¿˜åšäº†ä»¥ä¸‹æ”¹è¿›ï¼š

1. **å¯åŠ¨æµç¨‹ä¼˜åŒ–**
   - ä¸»çª—å£ç«‹å³æ˜¾ç¤ºï¼ˆä¸è¢«æ›´æ–°æ£€æŸ¥é˜»å¡ï¼‰
   - æ›´æ–°æ£€æŸ¥åœ¨åå°è¿›è¡Œï¼ˆå»¶è¿Ÿ 2 ç§’ï¼‰

2. **è¯¦ç»†çš„è°ƒè¯•è¾“å‡º**
   - æ¯ä¸ªæ­¥éª¤éƒ½æœ‰æ¸…æ™°çš„æ—¥å¿—
   - å¼‚å¸¸ä¿¡æ¯å®Œæ•´ï¼ˆåŒ…æ‹¬å†…éƒ¨å¼‚å¸¸ï¼‰
   - ä½¿ç”¨ â”â”â” åˆ†éš”ç¬¦ä¾¿äºæŸ¥æ‰¾

3. **å‹å¥½çš„é”™è¯¯æç¤º**
   - é”™è¯¯æ¶ˆæ¯æŒ‡å¼•ç”¨æˆ·æŸ¥çœ‹è¾“å‡ºçª—å£
   - æä¾›è¯¦ç»†çš„æ•…éšœæ’æŸ¥ä¿¡æ¯

## ğŸ‰ æ€»ç»“

ç°åœ¨åº”è¯¥å¯ä»¥æ­£å¸¸ä¸‹è½½å’Œå®‰è£…æ›´æ–°äº†ï¼

**å…³é”®ä¿®æ”¹**ï¼š
- âœ… åˆ›å»º `FixedUpdateManager` è®¾ç½® HttpClient BaseAddress
- âœ… è¾“å‡ºå®Œæ•´çš„è°ƒè¯•ä¿¡æ¯
- âœ… ä¼˜åŒ–å¯åŠ¨æµç¨‹

å¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œè¯·æä¾›è¾“å‡ºçª—å£ä¸­ â”â”â” ä¹‹é—´çš„å®Œæ•´æ—¥å¿—ä¿¡æ¯ã€‚

---

**ä¿®å¤æ—¥æœŸ**ï¼š2025-09-30  
**æµ‹è¯•ç‰ˆæœ¬**ï¼šBinanceApps 1.0.1 