# 变更日志 - 许可证和自动更新集成

## [2.3.3] - 2025-10-03

### 🎯 重要变更

#### ⭐ 服务器地址配置优化
- **新增**: 统一使用 `LicenseServerUrl` 配置所有服务器地址
- **优化**: 支持 `ContractApiServerUrl` 可选配置
- **优化**: 配置读取优先级机制（ContractApiServerUrl > LicenseServerUrl > 默认值）
- **移除**: 硬编码的服务器地址
- **影响**: 无需修改代码即可更改服务器地址

#### ⭐ 版本管理优化
- **新增**: `CurrentAppVersion` 存储在 `App.config`
- **优化**: 优先读取配置文件版本而非程序集版本
- **修复**: 更新后版本号正确更新，避免重复更新提示
- **新增**: `SaveCurrentVersion()` 方法自动保存版本号

#### ⭐ 数据保护机制
- **新增**: AppData 和 App.config 双重存储注册码
- **新增**: 更新时自动保护配置文件（`App.config`）
- **新增**: 自动保护数据文件（`*.db`, `*.log`, `*.dat`）
- **修复**: 更新后注册码不再丢失
- **优化**: 启动时从 AppData 自动恢复注册码

#### ⭐ 智能更新机制
- **新增**: 外部更新脚本机制
- **修复**: 完全解决 DLL 文件锁定问题
- **新增**: 自动备份旧版本
- **优化**: MD5 校验确保文件完整性
- **优化**: 失败后可手动回滚

### 📦 新增功能

#### 合约API集成
- **新增**: 量比排行 TOP20 功能
- **新增**: 从合约 API 获取流通量信息
- **新增**: 流通市值计算（流通数量 × 币价）
- **新增**: 量比计算（24H成交额 / 流通市值）

#### 仪表板功能
- **新增**: 综合信息仪表板
- **新增**: 24H涨跌幅 TOP10 显示
- **新增**: 量比排行 TOP20 显示
- **新增**: 高低价位置分布统计
- **新增**: 均线距离分布统计
- **新增**: 市场趋势综合分析

#### 用户体验
- **新增**: 双击复制合约符号功能
- **新增**: 鼠标悬停交互效果
- **新增**: 复制成功视觉反馈

### 🐛 Bug 修复

- **修复**: 合约符号重复添加 USDT 后缀导致匹配失败
- **修复**: Excel 错误值（`#VALUE!`）导致解析异常
- **修复**: 配置文件读取失败时无降级方案
- **修复**: 更新后版本号显示错误
- **修复**: DLL 文件锁定导致更新失败

### 📝 文档更新

- **更新**: `快速入门 - 许可证和自动更新集成.md` (v2.0)
- **更新**: `BinanceApps自动更新集成说明.md` (v2.0)
- **新增**: `许可证和自动更新集成 - v2.3.3更新说明.md`
- **新增**: `统一使用LicenseServerUrl配置说明.md`
- **新增**: `合约API加载失败诊断指南.md`
- **新增**: `量比排行符号匹配问题修复.md`
- **新增**: `仪表板版式优化说明.md`
- **新增**: `仪表板双击复制合约功能说明.md`

### 🔧 技术改进

- **优化**: 详细的调试日志输出
- **优化**: 错误处理和友好提示
- **优化**: 代码结构和可维护性
- **优化**: 配置管理的集中化
- **优化**: 向后兼容性

### ⚠️ 破坏性变更

**无** - 本版本完全向后兼容

---

## [1.0.4] - 2025-10-01

### 新增
- 基础许可证验证功能
- 基础自动更新功能
- 手动检查更新菜单

### 修复
- 初始版本，无修复记录

---

## [1.0.0] - 2025-09-30

### 初始版本
- 集成 `RegisterSrv.Client` NuGet 包
- 集成 `RegisterSrv.AutoUpdate` NuGet 包
- 实现基础许可证验证
- 实现基础自动更新功能

---

## 版本号规则

采用语义化版本号：`主版本号.次版本号.修订号`

- **主版本号**：重大架构变更或不兼容的API修改
- **次版本号**：向后兼容的功能性新增
- **修订号**：向后兼容的问题修复和优化

---

## 图例

- 🎯 **重要变更** - 影响用户体验或开发流程的重要改进
- ⭐ **核心功能** - 系统核心功能的重要更新
- 📦 **新增功能** - 新增的功能特性
- 🐛 **Bug修复** - 问题修复和错误处理
- 📝 **文档** - 文档更新和改进
- 🔧 **技术** - 技术层面的改进和优化
- ⚠️ **破坏性变更** - 需要用户或开发者注意的不兼容变更

---

**维护者**: AI Assistant  
**项目**: BinanceApps  
**文档版本**: 1.0  
**最后更新**: 2025-10-03

