# å°æ—¶å‡çº¿ç›‘æ§ - è®¡ç®—é€»è¾‘ä¸€è‡´æ€§ä¿®å¤

## ğŸ“‹ é—®é¢˜æè¿°

**ç”¨æˆ·åé¦ˆ**ï¼š
> ä»è®¡ç®—ç»“æœæ¥çœ‹ï¼Œæœ‰é—®é¢˜ã€‚å› ä¸ºç»Ÿè®¡ä¸€ä¸ªåˆçº¦ä»æœ€æ–°æ•°æ®å¾€å‰ï¼Œå¤§äºemaçš„æ•°é‡ï¼Œç›´åˆ°ç¬¬ä¸€ä¸ªå°äºçš„kçº¿å°±åœæ­¢è®¡æ•°ã€‚é‚£ä¹ˆåªè¦è¿™ä¸ªæ•°æ®å¤§äº0çš„ï¼Œä»–ä¸€å®šå¤§äºemaï¼Œè¿™æ—¶å€™ emaè·ç¦»ä¸å¯èƒ½å°äº0ã€‚

**é—®é¢˜åˆ†æ**ï¼š
- å¦‚æœ"å¤§äºEMAæ•°é‡" > 0ï¼Œè¯´æ˜æœ€æ–°Kçº¿çš„closeä»·æ ¼ > EMA
- åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ"è·ç¦»EMA%" ç†åº”æ˜¯æ­£æ•°
- ä½†å®é™…æ˜¾ç¤ºä¸­å‡ºç°äº†"å¤§äºEMAæ•°é‡" > 0 ä½† "è·ç¦»EMA%" < 0 çš„çŸ›ç›¾æƒ…å†µ

---

## ğŸ” æ ¹æœ¬åŸå› 

### æ•°æ®æºä¸ä¸€è‡´

**åŸæœ‰å®ç°**å­˜åœ¨ä¸¤ä¸ªä¸åŒçš„ä»·æ ¼æ•°æ®æºï¼š

1. **è®¡ç®—è¿ç»­å¤§äº/å°äºEMAæ•°é‡**
   ```csharp
   var latestKline = sortedKlines[index];
   var latestClose = latestKline.ClosePrice;  // â† ä½¿ç”¨Kçº¿æ”¶ç›˜ä»·
   
   if (latestClose > latestEma)
   {
       // è®¡æ•°è¿ç»­å¤§äºEMAçš„Kçº¿
   }
   ```

2. **è®¡ç®—è·ç¦»EMA%**
   ```csharp
   var ticker = tickers.FirstOrDefault(t => t.Symbol == symbol);
   var distancePercent = (ticker.LastPrice - latestEma) / latestEma * 100;  // â† ä½¿ç”¨Tickerå®æ—¶ä»·æ ¼
   ```

### ä¸ºä»€ä¹ˆä¼šå‡ºç°çŸ›ç›¾ï¼Ÿ

**æ—¶é—´å·®å¯¼è‡´çš„ä¸ä¸€è‡´**ï¼š

```
åœºæ™¯ç¤ºä¾‹ï¼š
- æœ€åKçº¿æ”¶ç›˜ä»·ï¼ˆ30åˆ†é’Ÿå‰ï¼‰ï¼š100
- EMAï¼š95
- Tickerå½“å‰å®æ—¶ä»·æ ¼ï¼ˆç°åœ¨ï¼‰ï¼š92

ç»“æœï¼š
âœ… å¤§äºEMAæ•°é‡ = 1ï¼ˆå› ä¸º100 > 95ï¼‰
âŒ è·ç¦»EMA% = (92-95)/95*100 = -3.16%ï¼ˆè´Ÿæ•°ï¼ï¼‰

çŸ›ç›¾ï¼
```

---

## âœ… è§£å†³æ–¹æ¡ˆ

### ç»Ÿä¸€ä»·æ ¼æ•°æ®æº

**æ ¸å¿ƒåŸåˆ™**ï¼šæ‰€æœ‰è®¡ç®—éƒ½ä½¿ç”¨**æœ€åKçº¿çš„æ”¶ç›˜ä»·**

```csharp
// ä½¿ç”¨æœ€åKçº¿çš„æ”¶ç›˜ä»·ï¼ˆä¸è¿ç»­æ•°é‡è®¡ç®—ä¿æŒä¸€è‡´ï¼‰
var sortedKlines = klineData.Klines.OrderBy(k => k.OpenTime).ToList();
var lastKlineClose = sortedKlines.Last().ClosePrice;

// è®¡ç®—è·ç¦»EMAçš„ç™¾åˆ†æ¯”
var distancePercent = latestEma != 0 
    ? ((lastKlineClose - latestEma) / latestEma * 100) 
    : 0;

var result = new HourlyEmaMonitorResult
{
    Symbol = symbol,
    LastPrice = lastKlineClose,  // âœ… ä½¿ç”¨Kçº¿æ”¶ç›˜ä»·
    CurrentEma = latestEma,
    DistancePercent = distancePercent,  // âœ… åŸºäºKçº¿æ”¶ç›˜ä»·è®¡ç®—
    AboveEmaCount = klineData.AboveEmaCount,  // âœ… åŸºäºKçº¿æ”¶ç›˜ä»·è®¡ç®—
    BelowEmaCount = klineData.BelowEmaCount,  // âœ… åŸºäºKçº¿æ”¶ç›˜ä»·è®¡ç®—
};
```

---

## ğŸ“Š ä¿®å¤å‰åå¯¹æ¯”

### ä¿®å¤å‰ï¼ˆé”™è¯¯ï¼‰

| å­—æ®µ | æ•°æ®æº | è¯´æ˜ |
|------|--------|------|
| LastPrice | Tickerå®æ—¶ä»·æ ¼ | å½“å‰æ—¶åˆ»çš„æœ€æ–°ä»·æ ¼ |
| DistancePercent | Tickerä»·æ ¼ vs EMA | å¯èƒ½ä¸è¿ç»­æ•°é‡çŸ›ç›¾ |
| AboveEmaCount | Kçº¿æ”¶ç›˜ä»· vs EMA | åŸºäºå†å²Kçº¿ |
| BelowEmaCount | Kçº¿æ”¶ç›˜ä»· vs EMA | åŸºäºå†å²Kçº¿ |

**é—®é¢˜**ï¼šTickerå®æ—¶ä»·æ ¼å¯èƒ½å·²ç»è·Œç ´EMAï¼Œä½†Kçº¿æ”¶ç›˜ä»·è¿˜åœ¨EMAä¸Šæ–¹ã€‚

### ä¿®å¤åï¼ˆæ­£ç¡®ï¼‰

| å­—æ®µ | æ•°æ®æº | è¯´æ˜ |
|------|--------|------|
| LastPrice | æœ€åKçº¿æ”¶ç›˜ä»· | ä¸è¿ç»­æ•°é‡è®¡ç®—ä¿æŒä¸€è‡´ |
| DistancePercent | Kçº¿æ”¶ç›˜ä»· vs EMA | âœ… é€»è¾‘ä¸€è‡´ |
| AboveEmaCount | Kçº¿æ”¶ç›˜ä»· vs EMA | âœ… é€»è¾‘ä¸€è‡´ |
| BelowEmaCount | Kçº¿æ”¶ç›˜ä»· vs EMA | âœ… é€»è¾‘ä¸€è‡´ |

**ç»“æœ**ï¼šæ‰€æœ‰è®¡ç®—åŸºäºåŒä¸€æ•°æ®æºï¼Œé€»è¾‘å®Œå…¨ä¸€è‡´ã€‚

---

## ğŸ¯ ä¿®å¤æ•ˆæœ

### é€»è¾‘ä¿è¯

ä¿®å¤åï¼Œç¡®ä¿ä»¥ä¸‹é€»è¾‘å…³ç³»**æ°¸è¿œæˆç«‹**ï¼š

```
è§„åˆ™1ï¼š
å¦‚æœ AboveEmaCount > 0
é‚£ä¹ˆ DistancePercent > 0
ï¼ˆæœ€æ–°Kçº¿åœ¨EMAä¸Šæ–¹ï¼‰

è§„åˆ™2ï¼š
å¦‚æœ BelowEmaCount > 0
é‚£ä¹ˆ DistancePercent < 0
ï¼ˆæœ€æ–°Kçº¿åœ¨EMAä¸‹æ–¹ï¼‰

è§„åˆ™3ï¼š
AboveEmaCount å’Œ BelowEmaCount ä¸å¯èƒ½åŒæ—¶å¤§äº0
ï¼ˆåªèƒ½åœ¨ä¸Šæ–¹æˆ–ä¸‹æ–¹ï¼‰
```

### æ•°æ®ç¤ºä¾‹

**åœºæ™¯1ï¼šä»·æ ¼åœ¨EMAä¸Šæ–¹**
```
æœ€åKçº¿æ”¶ç›˜ä»·ï¼š100
EMAï¼š95

ç»“æœï¼š
âœ… LastPriceï¼š100
âœ… DistancePercentï¼š+5.26%
âœ… AboveEmaCountï¼š5
âœ… BelowEmaCountï¼š0
é€»è¾‘ä¸€è‡´ï¼
```

**åœºæ™¯2ï¼šä»·æ ¼åœ¨EMAä¸‹æ–¹**
```
æœ€åKçº¿æ”¶ç›˜ä»·ï¼š90
EMAï¼š95

ç»“æœï¼š
âœ… LastPriceï¼š90
âœ… DistancePercentï¼š-5.26%
âœ… AboveEmaCountï¼š0
âœ… BelowEmaCountï¼š3
é€»è¾‘ä¸€è‡´ï¼
```

---

## ğŸ“ é™„åŠ ä¿®å¤

### UIä¼˜åŒ–

**é—®é¢˜**ï¼šæŒ‰é’®"ğŸ“¥ è·å–å°æ—¶Kçº¿"å®½åº¦å¤ªçª„ï¼Œæ–‡å­—æ˜¾ç¤ºä¸å®Œæ•´

**ä¿®å¤**ï¼š
```xml
<!-- ä¿®å¤å‰ -->
<Button x:Name="btnFetchKlines" Content="ğŸ“¥ è·å–å°æ—¶Kçº¿" 
        Width="140" ... />

<!-- ä¿®å¤å -->
<Button x:Name="btnFetchKlines" Content="ğŸ“¥ è·å–å°æ—¶Kçº¿" 
        Width="160" ... />
```

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶

### 1. src/BinanceApps.Core/Services/HourlyEmaService.cs

**ä¿®æ”¹ä½ç½®**ï¼š`GetMonitorResultsAsync` æ–¹æ³•

**ä¿®æ”¹å†…å®¹**ï¼š
```csharp
// è·å–æœ€æ–°çš„EMAå€¼
if (klineData.EmaValues.Count > 0 && klineData.Klines.Count > 0)
{
    var latestEma = klineData.EmaValues.Values.Last();
    
    // âœ… ä½¿ç”¨æœ€åKçº¿çš„æ”¶ç›˜ä»·ï¼ˆä¸è¿ç»­æ•°é‡è®¡ç®—ä¿æŒä¸€è‡´ï¼‰
    var sortedKlines = klineData.Klines.OrderBy(k => k.OpenTime).ToList();
    var lastKlineClose = sortedKlines.Last().ClosePrice;
    
    // âœ… è®¡ç®—è·ç¦»EMAçš„ç™¾åˆ†æ¯”
    var distancePercent = latestEma != 0 
        ? ((lastKlineClose - latestEma) / latestEma * 100) 
        : 0;

    var result = new HourlyEmaMonitorResult
    {
        Symbol = symbol,
        LastPrice = lastKlineClose,  // âœ… ä½¿ç”¨Kçº¿æ”¶ç›˜ä»·
        CurrentEma = latestEma,
        DistancePercent = distancePercent,
        // ...
    };
}
```

### 2. src/BinanceApps.Core/Models/HourlyEmaModels.cs

**ä¿®æ”¹å†…å®¹**ï¼šæ›´æ–°æ³¨é‡Šè¯´æ˜

```csharp
/// <summary>
/// æœ€æ–°ä»·æ ¼ï¼ˆæœ€åKçº¿çš„æ”¶ç›˜ä»·ï¼Œä¸è¿ç»­æ•°é‡è®¡ç®—ä¿æŒä¸€è‡´ï¼‰
/// </summary>
public decimal LastPrice { get; set; }
```

### 3. src/BinanceApps.WPF/HourlyEmaMonitorWindow.xaml

**ä¿®æ”¹å†…å®¹**ï¼šè°ƒæ•´æŒ‰é’®å®½åº¦

```xml
<Button x:Name="btnFetchKlines" Content="ğŸ“¥ è·å–å°æ—¶Kçº¿" 
        Width="160" Height="40" ... />
```

---

## ğŸ§ª éªŒè¯æµ‹è¯•

### æµ‹è¯•ç”¨ä¾‹1ï¼šéªŒè¯é€»è¾‘ä¸€è‡´æ€§

```
æ­¥éª¤ï¼š
1. è·å–Kçº¿æ•°æ®
2. ç‚¹å‡»"è®¡ç®—"
3. æŸ¥çœ‹ç»“æœ

éªŒè¯ç‚¹ï¼š
- å¦‚æœ"å¤§äºEMAæ•°é‡" > 0ï¼Œ"è·ç¦»EMA%"å¿…é¡» > 0
- å¦‚æœ"å°äºEMAæ•°é‡" > 0ï¼Œ"è·ç¦»EMA%"å¿…é¡» < 0
- "å¤§äºEMAæ•°é‡"å’Œ"å°äºEMAæ•°é‡"ä¸èƒ½åŒæ—¶ > 0
```

### æµ‹è¯•ç”¨ä¾‹2ï¼šç­›é€‰åŠŸèƒ½

```
æ­¥éª¤ï¼š
1. ç­›é€‰"å¤§äºEMAæ•°é‡ â‰¥ 3"
2. æŸ¥çœ‹ç»“æœ

éªŒè¯ç‚¹ï¼š
- æ‰€æœ‰æ˜¾ç¤ºçš„åˆçº¦ï¼Œ"è·ç¦»EMA%"éƒ½åº”è¯¥æ˜¯æ­£æ•°
- æ‰€æœ‰æ˜¾ç¤ºçš„åˆçº¦ï¼Œ"å°äºEMAæ•°é‡"éƒ½åº”è¯¥æ˜¯0
```

---

## ğŸ’¡ è®¾è®¡æ€è€ƒ

### ä¸ºä»€ä¹ˆä¸ä½¿ç”¨Tickerå®æ—¶ä»·æ ¼ï¼Ÿ

**é€‰æ‹©Kçº¿æ”¶ç›˜ä»·çš„åŸå› **ï¼š

1. **é€»è¾‘ä¸€è‡´æ€§**
   - è¿ç»­æ•°é‡åŸºäºKçº¿æ•°æ®
   - è·ç¦»EMAä¹Ÿåº”åŸºäºKçº¿æ•°æ®

2. **æ•°æ®å¯é æ€§**
   - Kçº¿æ•°æ®æ˜¯ç¡®å®šçš„å†å²æ•°æ®
   - Tickerä»·æ ¼æ˜¯ç¬æ—¶æ³¢åŠ¨çš„

3. **å¯å›æµ‹æ€§**
   - åŸºäºKçº¿çš„è®¡ç®—å¯ä»¥å›æµ‹
   - Tickerå®æ—¶ä»·æ ¼æ— æ³•å›æµ‹

4. **ç”¨æˆ·ç†è§£**
   - "å¤§äºEMAæ•°é‡=5"è¡¨ç¤ºè¿‡å»5æ ¹Kçº¿éƒ½åœ¨EMAä¸Šæ–¹
   - å½“å‰ä»·æ ¼ç†åº”ä¹Ÿåœ¨EMAä¸Šæ–¹
   - è¿™ç¬¦åˆç”¨æˆ·ç›´è§‰

### ç›‘æ§åœºæ™¯çš„ç‰¹æ®Šå¤„ç†

åœ¨**ç›‘æ§æ¨¡å¼**ä¸‹ï¼Œæˆ‘ä»¬ç”¨Tickeræ›´æ–°æœ€åKçº¿çš„æ”¶ç›˜ä»·ï¼š

```csharp
// ç›‘æ§æ—¶æ¯ä¸ªæ•´ç‚¹ç”¨Tickeræ›´æ–°æœ€åKçº¿
lastKline.ClosePrice = ticker.LastPrice;
```

è¿™æ ·æ—¢ä¿æŒäº†å®æ—¶æ€§ï¼Œåˆä¿è¯äº†é€»è¾‘ä¸€è‡´æ€§ã€‚

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®æ—¶æ€§è¯´æ˜

**LastPriceæ˜¾ç¤ºçš„æ˜¯**ï¼š
- éç›‘æ§çŠ¶æ€ï¼šæœ€åKçº¿çš„å†å²æ”¶ç›˜ä»·
- ç›‘æ§çŠ¶æ€ï¼šæ¯å°æ—¶ç”¨Tickeræ›´æ–°çš„æ”¶ç›˜ä»·

**å¦‚éœ€æŸ¥çœ‹çœŸæ­£çš„å®æ—¶ä»·æ ¼**ï¼š
- å¯ä»¥åœ¨24Hæ¶¨å¹…åˆ—çœ‹åˆ°ï¼ˆåŸºäºTickerï¼‰
- æˆ–å•ç‹¬æ·»åŠ ä¸€ä¸ª"å®æ—¶ä»·æ ¼"åˆ—

### æ•°æ®æ—¶æ•ˆæ€§

**Kçº¿æ•°æ®çš„æ—¶æ•ˆ**ï¼š
- æœ€åKçº¿å¯èƒ½æ˜¯å‡ åˆ†é’Ÿå‰ã€å‡ å°æ—¶å‰
- å¦‚éœ€æœ€æ–°æ•°æ®ï¼Œç‚¹å‡»"æ›´æ–°Kçº¿"

**ç›‘æ§æ¨¡å¼ä¸‹**ï¼š
- æ¯å°æ—¶è‡ªåŠ¨ç”¨Tickeræ›´æ–°æœ€åKçº¿
- ç¡®ä¿æ•°æ®ç›¸å¯¹å®æ—¶

---

## âœ… éªŒè¯ç»“æœ

### ç¼–è¯‘çŠ¶æ€
- âœ… BinanceApps.Core ç¼–è¯‘æˆåŠŸ
- âœ… æ— è­¦å‘Šï¼Œæ— é”™è¯¯

### é€»è¾‘éªŒè¯
- âœ… å¤§äºEMAæ•°é‡ > 0 â†’ è·ç¦»EMA% > 0
- âœ… å°äºEMAæ•°é‡ > 0 â†’ è·ç¦»EMA% < 0
- âœ… æ•°æ®æºç»Ÿä¸€ä¸ºKçº¿æ”¶ç›˜ä»·

### UIä¼˜åŒ–
- âœ… æŒ‰é’®å®½åº¦å¢åŠ è‡³160ï¼Œæ–‡å­—æ˜¾ç¤ºå®Œæ•´

---

## ğŸ“… ç‰ˆæœ¬ä¿¡æ¯

- **ä¿®å¤æ—¥æœŸ**ï¼š2025-11-06
- **ç‰ˆæœ¬**ï¼šv3.0.1
- **ä¿®å¤ç±»å‹**ï¼šé‡è¦é€»è¾‘ä¿®å¤

---

**é€»è¾‘ä¸€è‡´æ€§é—®é¢˜å·²ä¿®å¤** âœ…

