# 市场涨幅分布 - 0%分界线说明

## 📊 功能概述

在折线图的横坐标0%位置添加了一条竖直虚线，作为涨跌分界线，帮助用户快速识别市场整体是涨多还是跌多。

---

## ✨ 功能特性

### 视觉设计
- **位置**：横坐标0%（在"-9~0%"和"0~10%"两个档位之间）
- **样式**：竖直虚线
- **颜色**：青绿色 RGB(0, 150, 136)
- **线宽**：2px
- **虚线样式**：[6, 3]（6px实线，3px间隔）
- **标签**：在虚线顶部显示"0%"文字

### 标签样式
- **文字**："0%"
- **字号**：11px
- **字重**：Bold（加粗）
- **颜色**：青绿色 RGB(0, 150, 136)
- **背景**：半透明白色 RGBA(255, 255, 255, 230)
- **位置**：虚线顶部上方

---

## 🎨 视觉效果

### 示意图
```
Y轴
↑                        "0%"
│                         ↓
│    [折线图]             ┆
│                         ┆
│                         ┆  ← 竖直虚线（青绿色）
│                         ┆
│                         ┆
└─────────────────────────┆────────→ X轴
  <-50%  ...  -9~0%   0~10%  ...  >50%
                      ↑
                    0%位置
```

### 配色说明
**青绿色 RGB(0, 150, 136)**：
- 既不是纯红（下跌）也不是纯绿（上涨）
- 代表中性的分界线
- 与图表整体配色协调

---

## 🔧 技术实现

### 新增方法
**文件**：`src/BinanceApps.WPF/MarketDistributionWindow.xaml.cs`

```csharp
/// <summary>
/// 绘制0%分界线（竖直虚线）
/// </summary>
private void DrawZeroPercentLine(double left, double top, double width, double height, int rangeCount)
{
    // 0%的位置在第5个档位（Minus_9_0）和第6个档位（Plus_0_10）之间
    // 档位索引：0-11，0%在索引5和6之间，即5.5
    var x = left + (width * 5.5 / (rangeCount - 1));
    
    // 绘制竖直虚线
    var line = new Line
    {
        X1 = x,
        Y1 = top,
        X2 = x,
        Y2 = top + height,
        Stroke = new SolidColorBrush(Color.FromRgb(0, 150, 136)), // 青绿色
        StrokeThickness = 2,
        StrokeDashArray = new DoubleCollection { 6, 3 }
    };
    chartCanvas.Children.Add(line);
    
    // 添加"0%"标签
    var label = new TextBlock
    {
        Text = "0%",
        FontSize = 11,
        FontWeight = FontWeights.Bold,
        Foreground = new SolidColorBrush(Color.FromRgb(0, 150, 136)),
        Background = new SolidColorBrush(Color.FromArgb(230, 255, 255, 255)) // 半透明白色背景
    };
    Canvas.SetLeft(label, x - 12);
    Canvas.SetTop(label, top - 18);
    chartCanvas.Children.Add(label);
}
```

### 调用位置
在 `DrawChartContent` 方法中，在绘制网格线之后、绘制折线之前调用：

```csharp
// 绘制网格线
DrawGridLines(marginLeft, marginTop, chartWidth, chartHeight, maxCount);

// 绘制0%分界线（在Minus_9_0和Plus_0_10之间）
DrawZeroPercentLine(marginLeft, marginTop, chartWidth, chartHeight, rangeCount);

// 绘制每一天的折线
for (int i = 0; i < _currentResult.DailyDistributions.Count; i++)
{
    var distribution = _currentResult.DailyDistributions[i];
    DrawDistributionLine(distribution, ranges, marginLeft, marginTop, chartWidth, chartHeight, maxCount, i);
}
```

---

## 📐 位置计算逻辑

### 档位索引
12个档位按顺序：
```
索引 0: <-50%          (Below_50)
索引 1: -49~-40%       (Minus_49_40)
索引 2: -39~-30%       (Minus_39_30)
索引 3: -29~-20%       (Minus_29_20)
索引 4: -19~-10%       (Minus_19_10)
索引 5: -9~0%          (Minus_9_0)      ← 0%在这之后
─────────────────────────────────────────────────
索引 6: 0~10%          (Plus_0_10)      ← 0%在这之前
索引 7: 11~20%         (Plus_11_20)
索引 8: 21~30%         (Plus_21_30)
索引 9: 31~40%         (Plus_31_40)
索引 10: 41~50%        (Plus_41_50)
索引 11: >50%          (Above_50)
```

### 0%位置
**位置**：在索引5和索引6之间，即索引5.5

**X坐标计算**：
```csharp
// 总档位数：12
// 横坐标分成11段（12个点之间有11段）
// 0%在第5.5个位置

x = marginLeft + (chartWidth × 5.5 / (rangeCount - 1))
  = marginLeft + (chartWidth × 5.5 / 11)
```

**示例计算**（假设 chartWidth = 1100px）：
```
x = 60 + (1100 × 5.5 / 11)
  = 60 + (1100 × 0.5)
  = 60 + 550
  = 610px
```

---

## 🎯 用户价值

### 1. 快速判断市场整体趋势
- **分界线左侧**（下跌区）：合约数量多 → 市场整体偏空
- **分界线右侧**（上涨区）：合约数量多 → 市场整体偏多

### 2. 辅助趋势分析
**观察折线与0%线的关系**：
- 折线在0%线左侧集中 → 熊市行情
- 折线在0%线右侧集中 → 牛市行情
- 折线在0%线附近均匀分布 → 震荡行情

### 3. 历史对比
**对比不同天的折线位置**：
- 从左向右移动 → 市场转暖
- 从右向左移动 → 市场转冷
- 在0%线附近波动 → 盘整阶段

---

## 📊 使用场景

### 场景 1：判断市场情绪
**问题**：今天市场整体是涨还是跌？

**方法**：
1. 查看今日折线（最粗的深橙色实线）
2. 观察折线峰值位置与0%线的关系
3. 如果峰值在0%线左侧 → 跌的多
4. 如果峰值在0%线右侧 → 涨的多

---

### 场景 2：识别趋势转折
**问题**：市场趋势是否发生变化？

**方法**：
1. 对比5天的折线位置变化
2. 如果折线逐渐向右移动（越过0%线）→ 市场由跌转涨
3. 如果折线逐渐向左移动（越过0%线）→ 市场由涨转跌

---

### 场景 3：风险评估
**问题**：当前市场风险如何？

**方法**：
1. 观察折线在0%线两侧的分布
2. 严重偏向一侧 → 风险较高（可能反转）
3. 均匀分布 → 风险适中（震荡）
4. 集中在0%线附近 → 风险较低（稳定）

---

## 🎨 设计细节

### 为什么选择青绿色？
1. **中性色**：既不是红色（下跌）也不是绿色（上涨）
2. **高对比度**：在白色背景和彩色折线中都清晰可见
3. **专业感**：金融图表中常用的辅助线颜色

### 为什么用虚线？
1. **区分度**：与实线折线区分开
2. **非干扰性**：虚线不会遮挡数据
3. **辅助性**：表明这是参考线，不是数据线

### 为什么线宽2px？
1. **可见性**：足够清晰，易于识别
2. **不突兀**：不会抢夺折线的视觉焦点
3. **专业性**：符合图表设计规范

### 为什么添加"0%"标签？
1. **明确性**：用户一眼就知道这条线的含义
2. **易读性**：不需要参照横坐标就能理解
3. **专业性**：完整的图表应该有标注

---

## 🧪 测试验证

### 视觉验证
✅ **验证步骤**：
1. 运行程序
2. 打开"市场每日涨幅分布"窗口
3. 查看折线图

✅ **预期结果**：
- 在横坐标"-9~0%"和"0~10%"之间有一条青绿色竖直虚线
- 虚线从图表底部延伸到顶部
- 虚线顶部上方有"0%"标签
- 虚线样式为虚线（不是实线）
- 虚线颜色为青绿色
- 标签背景为半透明白色

---

### 位置验证
✅ **验证步骤**：
1. 观察虚线位置
2. 检查是否在"-9~0%"和"0~10%"之间

✅ **预期结果**：
- 虚线应该精确位于两个档位的中间位置
- 与X轴标签"-9~0%"和"0~10%"等距

---

### 功能验证
✅ **验证步骤**：
1. 观察折线与0%线的关系
2. 判断市场整体趋势

✅ **预期结果**：
- 如果今日折线在0%线左侧峰值高 → 下跌合约多
- 如果今日折线在0%线右侧峰值高 → 上涨合约多
- 如果折线在0%线附近对称 → 涨跌均衡

---

## 🔄 后续优化建议

### 1. 可配置的分界线
**功能**：允许用户自定义分界线位置
```
- 0%（默认）
- ±5%
- ±10%
- 自定义百分比
```

### 2. 多条参考线
**功能**：同时显示多条参考线
```
- -10% 线
- 0% 线（主要）
- +10% 线
```

### 3. 动态颜色
**功能**：根据折线位置动态调整分界线颜色
```
- 左侧峰值高 → 红色（市场偏空）
- 右侧峰值高 → 绿色（市场偏多）
- 对称分布 → 青绿色（市场均衡）
```

### 4. 数据标注
**功能**：在分界线上显示更多信息
```
"0%"
左：245个 | 右：258个
涨跌比：1.05
```

---

## 📝 修改文件清单

| 文件 | 修改内容 | 行数变化 |
|-----|---------|---------|
| `MarketDistributionWindow.xaml.cs` | 添加 DrawZeroPercentLine 方法 | +34行 |
| `MarketDistributionWindow.xaml.cs` | 调用 DrawZeroPercentLine | +3行 |

**总计**：1个文件，约37行代码

---

## ✅ 完成清单

- [x] 在0%位置添加竖直虚线
- [x] 使用青绿色和适当线宽
- [x] 添加"0%"标签
- [x] 标签带半透明白色背景
- [x] 在正确的绘制顺序中调用
- [x] 编译测试通过

---

**功能版本**: 1.0.3  
**添加日期**: 2025-10-05  
**开发者**: AI Assistant  
**状态**: ✅ 已完成并通过编译测试

