# 🔧 币安合约发行量数据维护工具使用说明

## 📋 功能概述

本工具用于获取和维护币安永续合约的发行量数据，支持自动化批量获取和手动维护，为主程序的市值计算功能提供数据支持。

## 🚀 快速开始

### 方式一：一键分批处理（推荐）
```bash
# 双击运行批处理文件
BatchFillSupplyData.bat
```

### 方式二：手动选择功能
```bash
# 交互式运行
UpdateSupplyData.bat

# 或直接使用命令行
dotnet run --project SupplyDataTool
```

## 📊 功能详解

### 1. 创建扩展发行量数据文件
- **功能**：创建包含48个主流合约的完整发行量数据
- **输出**：`Output/supply_data.json`
- **包含币种**：BTC、ETH、BNB、ADA、SOL等主流币种
- **命令**：`dotnet run --project SupplyDataTool -- 1`

### 2. 从Binance获取所有永续合约并创建模板文件
- **功能**：自动获取所有484个活跃永续合约列表
- **输出**：`Output/all_futures_contracts_template.json`
- **数据来源**：Binance Futures API
- **命令**：`dotnet run --project SupplyDataTool -- 2`

### 3. 自动从CoinGecko获取发行量数据并填写
- **功能**：自动从CoinGecko API获取发行量数据
- **输出**：`Output/supply_data_filled.json`
- **处理能力**：14,046个币种映射，智能匹配
- **命令**：`dotnet run --project SupplyDataTool -- 3`

### 4. 更新单个合约发行量数据
- **功能**：手动更新特定合约的发行量信息
- **适用场景**：补充自动获取失败的合约数据
- **交互式**：需要输入合约代码和发行量数据

### 5. 显示当前数据文件内容
- **功能**：查看已有数据文件的统计信息
- **显示内容**：合约数量、分类统计、更新时间

## 🎯 使用策略

### 推荐工作流程

1. **第一次使用**：
   ```bash
   # 运行分批处理脚本
   BatchFillSupplyData.bat
   
   # 选择 Y 开始自动填写
   ```

2. **日常维护**：
   ```bash
   # 更新单个合约
   dotnet run --project SupplyDataTool -- 4
   
   # 补充自动获取失败的数据
   dotnet run --project SupplyDataTool -- 3
   ```

3. **应用到主程序**：
   ```bash
   # 复制最终数据文件
   copy Output\supply_data_filled.json src\BinanceApps.WPF\bin\Debug\net8.0-windows\Data\supply_data.json
   ```

## ⚡ 性能优化

### API限制处理
- **CoinGecko免费API**：有请求频率限制
- **自动重试**：遇到429错误自动等待30秒重试
- **延迟控制**：每次请求间隔2秒
- **断点续传**：支持中断后从上次位置继续

### 分批处理建议
- **主流币种优先**：先处理市值较大的合约
- **分时段运行**：避免长时间连续请求
- **多次运行**：可重复运行补充失败的数据

## 📁 输出文件说明

### supply_data.json (14KB)
- **内容**：48个主流合约完整数据
- **特点**：数据完整，立即可用
- **适用**：快速启动市值功能

### all_futures_contracts_template.json (127KB)
- **内容**：484个合约模板（发行量为0）
- **特点**：结构完整，需要填写数据
- **适用**：作为自动填写的基础

### supply_data_filled.json (变动)
- **内容**：自动填写后的完整数据
- **特点**：包含尽可能多的真实发行量数据
- **适用**：生产环境使用

## 🔧 故障排除

### 常见问题

1. **API限制错误 (429)**
   - **现象**：`Too Many Requests`
   - **解决**：等待后重新运行，工具会自动处理

2. **网络连接失败**
   - **现象**：无法连接到API
   - **解决**：检查网络连接，确保可访问外网

3. **找不到币种映射**
   - **现象**：`无法找到 XXX 的CoinGecko ID`
   - **解决**：使用功能4手动添加该合约数据

4. **编译失败**
   - **现象**：`编译失败`
   - **解决**：确保安装了.NET 8.0 SDK

### 调试命令
```bash
# 查看详细错误信息
dotnet run --project SupplyDataTool --verbosity detailed

# 检查输出文件
dir Output\

# 查看文件内容
type Output\supply_data.json
```

## 📈 数据质量

### 数据来源可靠性
- **Binance API**：合约列表（100%准确）
- **CoinGecko API**：发行量数据（95%+覆盖率）
- **手动维护**：补充和修正数据

### 数据更新频率
- **合约列表**：实时获取
- **发行量数据**：建议每周更新
- **市值计算**：实时计算（基于最新价格）

## 💡 最佳实践

1. **定期更新**：建议每周运行一次自动填写
2. **数据备份**：重要数据文件建议备份
3. **分批处理**：大批量处理时使用分批脚本
4. **监控日志**：关注控制台输出，及时发现问题
5. **手动补充**：对重要合约可手动验证和补充数据

---

📞 **技术支持**：如遇到问题，请查看控制台输出的详细错误信息，或检查网络连接和API可用性。 