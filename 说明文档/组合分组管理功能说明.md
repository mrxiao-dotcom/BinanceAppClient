# 组合分组管理功能说明

## ✨ 功能概述

新增**分组创建与管理**功能，用户可以自定义创建分组，所有组合必须归属到一个已创建的分组中。系统不再使用默认分组，给用户更灵活的分类方式。

---

## 🎯 核心特性

### 1. 创建分组 ⭐

**位置**：组合列表上方，分组标签栏右侧的"+ 创建分组"按钮

**步骤**：
1. 点击"+ 创建分组"按钮
2. 输入分组名称（必填，建议不超过10个字符）
3. 输入分组说明（可选）
4. 点击"保存"

**示例分组**：
- 经典组：BTC、ETH等主流币
- 次新组：近期上线的新币
- 黑马组：短期涨幅较大的币种
- 潜力组：长期看好的币种
- 观察组：处于关键价位的币种

### 2. 分组标签栏

**显示内容**：
```
[全部 (12)] [经典组 (5)] [次新组 (3)] [黑马组 (4)]  [+ 创建分组]
```

**功能**：
- **"全部"标签**：显示所有组合（默认状态）
- **分组标签**：点击切换，仅显示该分组下的组合
- **数量显示**：每个分组标签显示该分组的组合数量
- **+ 创建分组**：快速创建新分组

### 3. 创建组合时选择分组

**位置**：创建/编辑组合对话框 → "所属分组"下拉框

**规则**：
- ✅ 必须选择一个分组（不允许为空）
- ✅ 下拉框动态加载已创建的分组
- ❌ 如果没有分组，会提示"（请先创建分组）"

**流程**：
```
创建组合前 → 先创建分组 → 创建组合时选择分组 → 保存
```

### 4. 分组筛选

**交互**：
- 点击分组标签 → 仅显示该分组的组合
- 点击"全部" → 显示所有组合
- 空分组 → 显示"「xx组」分组暂无组合"

---

## 🛠️ 使用流程

### 场景1：首次使用

**步骤**：
1. **打开"自定义板块监控"窗口**
2. **创建第一个分组**
   - 点击"+ 创建分组"
   - 输入"经典组"
   - 保存
3. **再创建其他分组**（如：次新组、黑马组）
4. **创建组合**
   - 点击"创建组合"
   - 填写组合信息
   - 在"所属分组"选择"经典组"
   - 添加合约
   - 保存

**提示**：建议先规划好分组体系，再创建组合。

### 场景2：按分组查看组合

**步骤**：
1. 打开"自定义板块监控"窗口
2. 观察分组标签栏：`[全部 (15)] [经典组 (5)] [次新组 (4)] [黑马组 (6)]`
3. 点击"经典组" → 仅显示5个经典组的组合
4. 点击"黑马组" → 仅显示6个黑马组的组合
5. 点击"全部" → 显示所有15个组合

---

## 📊 数据存储

### 分组数据

**存储位置**：
```
%LocalAppData%\BinanceApps\portfolio_groups.json
```

**文件格式**：
```json
{
  "Version": "1.0",
  "LastUpdated": "2025-10-02T...",
  "Groups": [
    {
      "Id": "guid-1",
      "Name": "经典组",
      "Description": "长期稳定的蓝筹币种",
      "Color": "#0078D4",
      "CreatedTime": "2025-10-02T...",
      "SortOrder": 0
    },
    {
      "Id": "guid-2",
      "Name": "次新组",
      "Description": "近期上线的新币种",
      "Color": "#0078D4",
      "CreatedTime": "2025-10-02T...",
      "SortOrder": 10
    }
  ]
}
```

### 组合数据

**GroupName字段**：
```json
{
  "Portfolios": [
    {
      "Id": "...",
      "Name": "DeFi蓝筹",
      "Description": "稳定的DeFi项目",
      "GroupName": "经典组",  ← 关联到分组
      "Symbols": [...]
    }
  ]
}
```

---

## 🎨 UI设计

### 创建分组对话框

```
┌──────────────────────────────────────┐
│  创建分组                             │
├──────────────────────────────────────┤
│  分组名称:                            │
│  [                        ]           │
│                                       │
│  分组说明（可选）:                     │
│  [                        ]           │
│  [                        ]           │
│                                       │
│                           [取消] [保存]│
└──────────────────────────────────────┘
```

### 分组标签栏样式

**绿色按钮** (创建分组):
- 背景：#28A745
- 文字：白色
- 文字：+ 创建分组

**蓝色标签** (选中状态):
- 背景：#0078D4
- 文字：白色
- 字体：加粗

**白色标签** (未选中):
- 背景：白色
- 边框：#0078D4
- 文字：#0078D4

---

## 🔧 技术实现

### 1. 新增文件

| 文件 | 说明 |
|------|------|
| `src/BinanceApps.Core/Models/PortfolioGroup.cs` | 分组数据模型 |
| `src/BinanceApps.Core/Services/PortfolioGroupService.cs` | 分组管理服务 |
| `src/BinanceApps.WPF/GroupEditorDialog.xaml` | 创建分组对话框UI |
| `src/BinanceApps.WPF/GroupEditorDialog.xaml.cs` | 对话框逻辑 |

### 2. 修改文件

| 文件 | 修改内容 |
|------|----------|
| `CustomPortfolio.cs` | GroupName默认值改为空字符串 |
| `CustomPortfolioService.cs` | 创建/更新方法的groupName默认值改为空 |
| `CustomPortfolioWindow.xaml` | 添加"+ 创建分组"按钮 |
| `CustomPortfolioWindow.xaml.cs` | 集成PortfolioGroupService，添加创建分组逻辑 |
| `PortfolioEditorDialog.xaml` | 分组下拉框改为动态加载 |
| `PortfolioEditorDialog.xaml.cs` | 添加LoadGroupsToComboBox方法，验证分组不为空 |
| `MainWindow.xaml.cs` | 注册PortfolioGroupService到DI容器 |

### 3. 核心流程

```
启动应用
  ↓
初始化PortfolioGroupService
  ↓
加载portfolio_groups.json
  ↓
显示分组标签栏（动态）
  ↓
用户点击"+ 创建分组"
  ↓
打开GroupEditorDialog
  ↓
保存到portfolio_groups.json
  ↓
刷新标签栏
```

---

## ⚠️ 重要变更

### 与之前版本的区别

**之前（预设分组）**：
- ❌ 下拉框有6个预设分组（默认分组、经典组、次新组...）
- ❌ 可以直接输入自定义分组名称
- ❌ GroupName默认值为"默认分组"

**现在（自定义分组）**：
- ✅ 下拉框仅显示用户创建的分组
- ✅ 必须先创建分组，才能创建组合
- ✅ GroupName默认值为空字符串
- ✅ 创建组合时必须选择分组（不允许为空）

### 数据兼容性

**旧数据处理**：
- 如果旧组合的GroupName为空或"默认分组"，可能需要手动迁移到新分组
- 建议清理旧数据，重新创建分组和组合

---

## 🧪 测试步骤

### 测试1：创建分组

1. ✅ 打开"自定义板块监控"
2. ✅ 点击"+ 创建分组"
3. ✅ 输入"经典组"，点击保存
4. ✅ 检查标签栏是否出现"经典组 (0)"
5. ✅ 再创建"次新组"、"黑马组"

**预期结果**：
```
[全部 (0)] [经典组 (0)] [次新组 (0)] [黑马组 (0)]  [+ 创建分组]
```

### 测试2：创建组合（先创建分组）

1. ✅ 点击"创建组合"
2. ✅ 填写组合名称
3. ✅ 在"所属分组"下拉框选择"经典组"
4. ✅ 添加几个合约
5. ✅ 保存
6. ✅ 检查标签栏更新为"经典组 (1)"

### 测试3：创建组合（没有分组）

1. ✅ 删除所有分组数据（`%LocalAppData%\BinanceApps\portfolio_groups.json`）
2. ✅ 重启应用
3. ✅ 点击"创建组合"
4. ✅ 检查"所属分组"显示"（请先创建分组）"
5. ✅ 尝试保存，应该提示"请选择组合所属分组"

### 测试4：分组筛选

1. ✅ 创建3个经典组的组合
2. ✅ 创建2个次新组的组合
3. ✅ 点击"经典组"，仅显示3个组合
4. ✅ 点击"次新组"，仅显示2个组合
5. ✅ 点击"全部"，显示所有5个组合

### 测试5：修改组合分组

1. ✅ 点击组合的"修"按钮
2. ✅ 修改"所属分组"为其他分组
3. ✅ 保存
4. ✅ 检查组合移动到新分组，标签栏数量更新

---

## 📝 常见问题

### Q1：我没有创建分组，能创建组合吗？

**A**: 不能。系统要求先创建至少一个分组，才能创建组合。

### Q2：可以删除分组吗？

**A**: 当前版本不支持删除分组。如果需要此功能，可后续添加。

**建议**：
- 将该分组下的所有组合移动到其他分组
- 手动编辑 `portfolio_groups.json` 删除分组数据

### Q3：分组数据存储在哪里？

**A**: 存储在 `%LocalAppData%\BinanceApps\portfolio_groups.json`

### Q4：分组名称有长度限制吗？

**A**: 建议不超过10个字符，超过会提示但允许继续。

### Q5：可以修改分组名称或说明吗？

**A**: 当前版本不支持修改分组信息。如需修改，请：
1. 手动编辑 `portfolio_groups.json`
2. 重启应用

### Q6：旧数据（使用默认分组）怎么办？

**A**: 
1. 创建新分组
2. 逐个编辑旧组合，修改其分组
3. 或清空旧数据，重新创建

---

## 🚀 未来扩展

### 可能的功能增强

1. **分组管理界面**
   - 统一管理所有分组
   - 支持修改分组名称、说明
   - 支持删除分组（检查是否有组合使用）
   - 支持分组排序

2. **批量操作**
   - 批量修改组合分组
   - 分组间批量移动组合

3. **分组颜色**
   - 为每个分组设置不同颜色
   - 组合列表使用分组颜色区分

4. **分组统计**
   - 各分组的总体表现
   - 分组级别的涨跌统计

---

## 💡 使用建议

### 推荐的分组体系

**按投资策略**：
```
长线组 → 长期持有的币种（BTC、ETH）
波段组 → 适合波段操作的币种
定投组 → 定期定额投资的币种
```

**按市场热度**：
```
热门组 → 近期市场热度高
冷门组 → 被市场忽视的潜力币
稳健组 → 波动较小的币种
```

**按生态**：
```
以太坊生态 → ETH及Layer2
BSC生态 → BNB及BSC链上项目
Solana生态 → SOL及Solana链上项目
```

**按操作状态**：
```
持仓组 → 当前持有
关注组 → 计划买入
止盈组 → 准备卖出
```

---

**功能版本**: 1.0.9  
**实现日期**: 2025-10-02  
**测试状态**: ✅ 待验证  
**相关文档**: `组合分组功能说明.md` 