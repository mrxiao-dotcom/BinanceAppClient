# BinanceApps 构建目录说明

## 📁 目录结构概览

```
src/BinanceApps.WPF/bin/
├── Debug/                          # Debug构建输出
│   └── net9.0-windows/            # .NET 9.0框架目标
│       └── *.exe, *.dll, *.config # 调试版本文件
│
└── Release/                        # Release构建输出
    ├── net9.0-windows/            # ⭐ 主要运行目录
    │   ├── BinanceApps.WPF.exe   # 主程序（这是您运行的程序）
    │   ├── App.config             # 运行时配置文件
    │   ├── *.dll                  # 依赖库
    │   ├── *.bak                  # 自动更新备份文件
    │   ├── KlineData/             # K线数据
    │   ├── MaDistanceData/        # 均线距离数据
    │   ├── Data/                  # 其他数据
    │   ├── publish/               # dotnet publish输出
    │   └── win-x64/               # 特定平台构建
    │
    ├── BinanceApps.WPF.exe        # 🚫 框架依赖版本（不推荐使用）
    ├── App.config                 # 🚫 编译时配置（不会被使用）
    └── *.dll                      # 🚫 依赖库（不完整）
```

---

## 🎯 重要说明

### ⭐ 您应该使用的可执行程序

**正确的运行路径**：
```
src/BinanceApps.WPF/bin/Release/net9.0-windows/BinanceApps.WPF.exe
```

**为什么？**
1. ✅ 这是完整的自包含目录
2. ✅ 包含所有依赖DLL
3. ✅ 配置文件会被正确读取
4. ✅ 数据目录在这里创建
5. ✅ 自动更新功能针对这个目录工作

---

## 🔍 各目录说明

### 1. `bin/Release/` 根目录下的文件

**来源**：.NET SDK 构建系统的中间输出

**特点**：
- 这是**框架依赖**版本
- 需要用户机器已安装 .NET 9.0 Runtime
- **不推荐直接使用**，文件不完整

**用途**：构建系统的中间产物，可以忽略

---

### 2. `bin/Release/net9.0-windows/` ⭐ 主目录

**来源**：实际的运行时输出目录

**特点**：
- 完整的应用程序目录
- 包含所有必需的依赖
- **这是您应该运行和发布的版本**

**包含内容**：
- `BinanceApps.WPF.exe` - 主程序
- `App.config` - **运行时配置文件（需要修改这个）**
- `*.dll` - 所有依赖库
- `KlineData/` - K线数据存储
- `MaDistanceData/` - 均线距离数据
- `Data/` - 其他数据文件

---

### 3. `*.bak` 备份文件

**来源**：自动更新功能创建的备份

**特点**：
- 在程序更新前自动创建
- 更新失败时可以恢复
- **可以定期清理旧备份**

**清理方法**：
```bash
# 删除所有.bak文件（慎重操作）
del /s *.bak
```

---

### 4. `publish/` 和 `win-x64/` 目录

**来源**：使用 `dotnet publish` 命令创建

**用途**：
- 创建特定平台的发布版本
- 可以是单文件发布或自包含发布
- 用于制作安装包或分发

---

## 🛠️ 维护建议

### ✅ 推荐做法

1. **始终使用 `net9.0-windows/` 目录**
   ```
   运行：src/BinanceApps.WPF/bin/Release/net9.0-windows/BinanceApps.WPF.exe
   ```

2. **修改配置文件的正确位置**
   ```
   配置：src/BinanceApps.WPF/bin/Release/net9.0-windows/App.config
   ```

3. **定期清理备份文件**
   - 保留最近3-5次更新的备份
   - 删除过期的 `.bak` 文件

4. **数据目录管理**
   - 数据会自动保存在 `net9.0-windows/` 下
   - 定期备份 `KlineData/`, `MaDistanceData/`, `Data/` 目录

---

## 📦 发布程序时的打包

### 方法一：手动打包（当前方式）

**打包目录**：
```
src/BinanceApps.WPF/bin/Release/net9.0-windows/
```

**排除文件**：
- `*.bak` - 备份文件
- `*.pdb` - 调试符号
- `KlineData/` - K线数据（可选）
- `MaDistanceData/` - 历史数据（可选）
- `Data/` - 数据库文件（可选）

**包含文件**：
- `BinanceApps.WPF.exe`
- `App.config`
- 所有 `*.dll` 文件
- `runtimes/` 目录（必需）
- `appsettings.json`

---

### 方法二：使用 dotnet publish（推荐）

**命令**：
```bash
cd src/BinanceApps.WPF
dotnet publish -c Release -r win-x64 --self-contained false -o publish
```

**优点**：
- 自动处理依赖
- 输出目录干净
- 适合制作安装包

---

## 🔧 快速修改服务器地址

**1. 找到正确的配置文件**
```
src/BinanceApps.WPF/bin/Release/net9.0-windows/App.config
```

**2. 修改服务器地址**
```xml
<add key="LicenseServerUrl" value="http://您的新服务器地址:端口" />
```

**3. 重启程序**
- 无需重新编译
- 直接生效

---

## 🗑️ 清理建议

### 清理 bin 目录（保留核心文件）

```bash
# 删除 bin/Release/ 根目录下的文件（保留net9.0-windows目录）
cd src/BinanceApps.WPF/bin/Release
# 删除根目录下的所有文件（不包括文件夹）
del /q *.exe *.dll *.json *.config *.pdb *.xml

# 清理备份文件
cd net9.0-windows
del /q *.bak
```

### 保留数据清理编译输出

```bash
# 完全清理 bin 和 obj
cd src/BinanceApps.WPF
rmdir /s /q bin obj

# 重新编译
dotnet build -c Release
```

---

## 📝 总结

### ⭐ 关键要点

1. **运行位置**
   ```
   bin/Release/net9.0-windows/BinanceApps.WPF.exe  ← 使用这个
   ```

2. **配置文件**
   ```
   bin/Release/net9.0-windows/App.config  ← 修改这个
   ```

3. **发布打包**
   ```
   打包整个 net9.0-windows/ 目录
   排除 *.bak, *.pdb, KlineData/, Data/
   ```

4. **其他目录**
   - `bin/Release/*.exe` - 可以忽略（框架依赖版本）
   - `*.bak` - 定期清理
   - `publish/`, `win-x64/` - 按需使用

---

## 🆘 常见问题

### Q: 为什么有两套可执行程序？

**A**: 这是 .NET SDK 构建系统的设计：
- **根目录** (`bin/Release/`) - 框架依赖版本（中间产物）
- **子目录** (`bin/Release/net9.0-windows/`) - 实际运行版本（完整）

### Q: 可以删除根目录的文件吗？

**A**: 可以，但不推荐：
- 不会影响程序运行
- 下次编译会重新生成
- 建议保持原样

### Q: 数据会保存在哪里？

**A**: 两个位置：
1. **程序目录**: `bin/Release/net9.0-windows/KlineData/`, `MaDistanceData/`
2. **用户目录**: `%LocalAppData%\BinanceApps\` （AppData）

### Q: 如何制作绿色版安装包？

**A**: 直接打包 `net9.0-windows/` 目录即可：
```bash
# 使用PowerShell
Compress-Archive -Path "bin/Release/net9.0-windows/*" `
                 -DestinationPath "BinanceApps_v1.0.8.zip" `
                 -Exclude "*.bak","*.pdb","KlineData","Data"
```

---

**文档版本**: 1.0  
**更新日期**: 2025-10-01  
**适用版本**: BinanceApps 1.0.8 