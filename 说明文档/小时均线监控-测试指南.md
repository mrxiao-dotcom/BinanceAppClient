# 小时均线监控功能 - 测试指南

## 测试前准备

1. 确保项目已成功编译
2. 确保API配置正确（或使用模拟数据）
3. 确保网络连接正常

## 测试步骤

### 1. 启动应用程序

```bash
cd src/BinanceApps.WPF
dotnet run
```

或者直接在Visual Studio中按F5运行

### 2. 打开小时均线监控窗口

1. 在主窗口左侧导航栏找到"⏱️ 小时均线监控"按钮
2. 点击按钮，应该打开新窗口
3. 检查窗口是否正常显示：
   - ✅ 窗口标题为"小时均线监控"
   - ✅ 顶部有控制按钮（获取小时K线、启动监控、停止监控、清除缓存）
   - ✅ 右侧有参数输入框（N天均线、X根K线）
   - ✅ 中间有数据表格
   - ✅ 底部有状态栏

### 3. 测试参数验证

#### 测试用例3.1：无效参数
1. 在"N天均线"输入框输入：50
2. 在"X根K线"输入框输入：30
3. 点击"📥 获取小时K线"按钮
4. **预期结果**：显示错误提示"X根K线数量（30）必须大于等于N天均线（50）"

#### 测试用例3.2：负数参数
1. 在"N天均线"输入框输入：-10
2. 点击"📥 获取小时K线"按钮
3. **预期结果**：显示错误提示"请输入有效的N天均线参数（大于0的整数）"

#### 测试用例3.3：非数字参数
1. 在"N天均线"输入框输入：abc
2. 点击"📥 获取小时K线"按钮
3. **预期结果**：显示错误提示"请输入有效的N天均线参数（大于0的整数）"

### 4. 测试数据获取

#### 测试用例4.1：正常获取数据
1. 在"N天均线"输入框输入：26（默认值）
2. 在"X根K线"输入框输入：100（默认值）
3. 点击"📥 获取小时K线"按钮
4. **预期结果**：
   - ✅ 按钮变为"获取中..."并禁用
   - ✅ 状态栏显示"正在获取小时K线数据..."
   - ✅ 进度栏显示下载进度（例如："进度: 50/200 (25%) - BTCUSDT"）
   - ✅ 获取完成后状态变为"K线数据获取完成，正在计算EMA..."
   - ✅ EMA计算完成后显示"数据准备完成"
   - ✅ 数据表格显示所有合约的监控结果
   - ✅ 表格标题显示"监控结果 (共 X 个合约)"
   - ✅ "启动监控"按钮变为可用
   - ✅ 显示成功提示框

#### 测试用例4.2：小数据量测试
1. 在"N天均线"输入框输入：5
2. 在"X根K线"输入框输入：10
3. 点击"📥 获取小时K线"按钮
4. **预期结果**：
   - ✅ 快速完成数据获取和计算
   - ✅ 所有合约都显示在表格中

### 5. 测试数据显示

#### 测试用例5.1：检查数据列
检查表格中的所有列是否正确显示：
- ✅ 合约名（例如：BTCUSDT）
- ✅ 最新价格（8位小数）
- ✅ 当前EMA（8位小数）
- ✅ 距离EMA(%)（2位小数，红色为正，绿色为负）
- ✅ 24H涨幅(%)（2位小数，红色为正，绿色为负）
- ✅ K线数量（整数）
- ✅ 更新时间（HH:mm:ss格式）

#### 测试用例5.2：检查颜色标识
1. 找到距离EMA为正值的行
2. **预期结果**：距离EMA列文字为红色
3. 找到距离EMA为负值的行
4. **预期结果**：距离EMA列文字为绿色

#### 测试用例5.3：双击复制功能
1. 双击任意一行
2. 打开记事本，按Ctrl+V粘贴
3. **预期结果**：粘贴的内容为该行的合约名

### 6. 测试监控功能

#### 测试用例6.1：启动监控
1. 确保已成功获取数据
2. 点击"▶️ 启动监控"按钮
3. **预期结果**：
   - ✅ "启动监控"按钮变为禁用
   - ✅ "停止监控"按钮变为可用
   - ✅ "获取小时K线"按钮变为禁用
   - ✅ 参数输入框变为禁用
   - ✅ 状态栏显示"监控中... (每5分钟更新一次)"
   - ✅ 控制台输出"✅ 小时均线监控已启动"

#### 测试用例6.2：监控更新
1. 启动监控后等待5分钟
2. **预期结果**：
   - ✅ 控制台输出"🔄 开始更新小时均线监控数据..."
   - ✅ 表格数据自动刷新
   - ✅ 更新时间列显示新的时间
   - ✅ 状态栏显示最后更新时间

#### 测试用例6.3：停止监控
1. 监控运行中，点击"⏸️ 停止监控"按钮
2. **预期结果**：
   - ✅ "启动监控"按钮变为可用
   - ✅ "停止监控"按钮变为禁用
   - ✅ "获取小时K线"按钮变为可用
   - ✅ 参数输入框变为可用
   - ✅ 状态栏显示"监控已停止"
   - ✅ 控制台输出"⏹️ 小时均线监控已停止"
   - ✅ 显示提示框"监控已停止"

### 7. 测试缓存管理

#### 测试用例7.1：清除缓存
1. 获取数据后，点击"🗑️ 清除缓存"按钮
2. 在确认对话框中点击"是"
3. **预期结果**：
   - ✅ 数据表格清空
   - ✅ 表格标题显示"监控结果 (共 0 个合约)"
   - ✅ 状态栏显示"缓存已清除"
   - ✅ "启动监控"按钮变为禁用
   - ✅ 控制台输出"🗑️ 已清除所有缓存数据"
   - ✅ 显示成功提示框"缓存已清除"

#### 测试用例7.2：取消清除
1. 点击"🗑️ 清除缓存"按钮
2. 在确认对话框中点击"否"
3. **预期结果**：
   - ✅ 数据保持不变
   - ✅ 对话框关闭，无其他操作

### 8. 测试文件存储

#### 测试用例8.1：检查文件生成
1. 获取数据后，打开项目目录
2. 导航到 `KlineData/HourlyEma/` 目录
3. **预期结果**：
   - ✅ 目录存在
   - ✅ 每个合约都有对应的JSON文件（例如：BTCUSDT_hourly.json）
   - ✅ 文件包含K线数据和EMA值

#### 测试用例8.2：检查文件内容
1. 打开任意一个生成的JSON文件
2. **预期结果**：
   - ✅ JSON格式正确
   - ✅ 包含symbol字段
   - ✅ 包含klines数组
   - ✅ 包含emaValues对象
   - ✅ 包含lastUpdateTime字段

### 9. 测试异常情况

#### 测试用例9.1：监控期间关闭窗口
1. 启动监控
2. 直接关闭窗口
3. **预期结果**：
   - ✅ 窗口正常关闭
   - ✅ 监控自动停止
   - ✅ 控制台输出"⏹️ 小时均线监控已停止"

#### 测试用例9.2：未获取数据就启动监控
1. 打开窗口后，直接点击"▶️ 启动监控"按钮
2. **预期结果**：
   - ✅ 按钮保持禁用状态（不可点击）

#### 测试用例9.3：网络异常
1. 断开网络连接
2. 点击"📥 获取小时K线"按钮
3. **预期结果**：
   - ✅ 显示错误提示
   - ✅ 按钮恢复正常状态
   - ✅ 状态栏显示"获取失败"

### 10. 性能测试

#### 测试用例10.1：大数据量
1. 在"N天均线"输入框输入：50
2. 在"X根K线"输入框输入：500
3. 点击"📥 获取小时K线"按钮
4. **预期结果**：
   - ✅ 能够正常完成数据获取
   - ✅ EMA计算正确
   - ✅ 界面不卡顿

#### 测试用例10.2：多次获取
1. 完成一次数据获取
2. 修改参数
3. 再次点击"📥 获取小时K线"按钮
4. **预期结果**：
   - ✅ 旧数据被清除
   - ✅ 新数据正确显示
   - ✅ 没有内存泄漏

## 测试检查清单

### 功能测试
- [ ] 窗口能正常打开
- [ ] 参数验证正确
- [ ] 数据获取成功
- [ ] EMA计算正确
- [ ] 监控功能正常
- [ ] 缓存管理有效
- [ ] 文件存储正确
- [ ] 双击复制功能正常

### UI测试
- [ ] 所有按钮显示正确
- [ ] 颜色标识正确
- [ ] 表格显示正常
- [ ] 状态栏更新及时
- [ ] 进度显示正确

### 性能测试
- [ ] 大数据量处理正常
- [ ] 界面响应流畅
- [ ] 内存占用合理
- [ ] CPU占用正常

### 异常测试
- [ ] 网络异常处理正确
- [ ] 参数异常提示清晰
- [ ] 关闭窗口无报错
- [ ] 缓存清理完整

## 已知问题

（记录测试过程中发现的问题）

1. 
2. 
3. 

## 测试结论

- [ ] 通过
- [ ] 不通过（需要修复）

## 测试人员

- 测试人员：__________
- 测试日期：__________
- 测试版本：__________

## 备注

（记录其他需要说明的内容）

